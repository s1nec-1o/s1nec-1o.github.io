<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Android逆向之Wiki篇 | S1nec-1o's B1og</title><meta name="author" content="s1nec-1o"><meta name="copyright" content="s1nec-1o"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="静态分析java层2014 ASIS Cyber Security Contest Finals Numdroid逆向分析12345678910111213141516171819202122232425262728293031protected void onCreate(Bundle savedInstanceState) &#123;    super.onCreate(savedInsta">
<meta property="og:type" content="article">
<meta property="og:title" content="Android逆向之Wiki篇">
<meta property="og:url" content="http://s1nec-1o.github.io/2025/04/14/Android%E9%80%86%E5%90%91%E4%B9%8BWiki%E7%AF%87/index.html">
<meta property="og:site_name" content="S1nec-1o&#39;s B1og">
<meta property="og:description" content="静态分析java层2014 ASIS Cyber Security Contest Finals Numdroid逆向分析12345678910111213141516171819202122232425262728293031protected void onCreate(Bundle savedInstanceState) &#123;    super.onCreate(savedInsta">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281614288.png">
<meta property="article:published_time" content="2025-04-14T06:44:43.000Z">
<meta property="article:modified_time" content="2025-04-14T06:56:13.691Z">
<meta property="article:author" content="s1nec-1o">
<meta property="article:tag" content="android">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281614288.png"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281712481.jpg"><link rel="canonical" href="http://s1nec-1o.github.io/2025/04/14/Android%E9%80%86%E5%90%91%E4%B9%8BWiki%E7%AF%87/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"距离文章发布已经过去","messageNext":"天了，信息可能已经过时"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Android逆向之Wiki篇',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-04-14 14:56:13'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 8 || hour >= 20
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="S1nec-1o's B1og" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281614288.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281616326.png')"><nav id="nav"><span id="blog-info"><a href="/" title="S1nec-1o's B1og"><span class="site-name">S1nec-1o's B1og</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Android逆向之Wiki篇</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-14T06:44:43.000Z" title="发表于 2025-04-14 14:44:43">2025-04-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-14T06:56:13.691Z" title="更新于 2025-04-14 14:56:13">2025-04-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%89%E5%8D%93%E9%80%86%E5%90%91/">安卓逆向</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="静态分析java层"><a href="#静态分析java层" class="headerlink" title="静态分析java层"></a>静态分析java层</h1><h2 id="2014-ASIS-Cyber-Security-Contest-Finals-Numdroid"><a href="#2014-ASIS-Cyber-Security-Contest-Finals-Numdroid" class="headerlink" title="2014 ASIS Cyber Security Contest Finals Numdroid"></a>2014 ASIS Cyber Security Contest Finals Numdroid</h2><h3 id="逆向分析"><a href="#逆向分析" class="headerlink" title="逆向分析"></a>逆向分析</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="type">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    super.<span class="built_in">onCreate</span>(savedInstanceState);</span><br><span class="line">    <span class="built_in">setContentView</span>(R.layout.activity_main);</span><br><span class="line">    ArrayTools.<span class="built_in">each_with_index</span>(buttons, <span class="keyword">new</span> <span class="built_in">EachIndexAction</span>&lt;Integer&gt;() &#123; <span class="comment">// from class: io.asis.ctf2014.numdriod.MainActivity.1</span></span><br><span class="line">        @Override <span class="comment">// io.asis.ctf2014.numdriod.tools.EachIndexAction</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">void</span> <span class="built_in">action</span>(<span class="keyword">final</span> <span class="type">int</span> i, Integer element) &#123;</span><br><span class="line">            ((Button) MainActivity.<span class="keyword">this</span>.<span class="built_in">findViewById</span>(element.<span class="built_in">intValue</span>())).<span class="built_in">setOnClickListener</span>(<span class="keyword">new</span> View.<span class="built_in">OnClickListener</span>() &#123; <span class="comment">// from class: io.asis.ctf2014.numdriod.MainActivity.1.1</span></span><br><span class="line">                @Override <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="type">void</span> <span class="built_in">onClick</span>(View arg0) &#123;</span><br><span class="line">                    MainActivity.<span class="keyword">this</span>.<span class="built_in">clicked</span>(i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.mScreen = (EditText) <span class="built_in">findViewById</span>(R.id.editText1);</span><br><span class="line">    <span class="keyword">this</span>.mScreen.<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">this</span>.mOk = (ImageButton) <span class="built_in">findViewById</span>(R.id.ok);</span><br><span class="line">    <span class="keyword">this</span>.mDel = (ImageButton) <span class="built_in">findViewById</span>(R.id.del);</span><br><span class="line">    <span class="keyword">this</span>.mOk.<span class="built_in">setOnClickListener</span>(<span class="keyword">new</span> View.<span class="built_in">OnClickListener</span>() &#123; <span class="comment">// from class: io.asis.ctf2014.numdriod.MainActivity.2</span></span><br><span class="line">        @Override <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">void</span> <span class="built_in">onClick</span>(View arg0) &#123;</span><br><span class="line">            MainActivity.<span class="keyword">this</span>.<span class="built_in">ok_clicked</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.mDel.<span class="built_in">setOnClickListener</span>(<span class="keyword">new</span> View.<span class="built_in">OnClickListener</span>() &#123; <span class="comment">// from class: io.asis.ctf2014.numdriod.MainActivity.3</span></span><br><span class="line">        @Override <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">void</span> <span class="built_in">onClick</span>(View arg0) &#123;</span><br><span class="line">            MainActivity.<span class="keyword">this</span>.<span class="built_in">del_clicked</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>首先遍历按钮数组，并进行初始化和设置点击事件 <code>MainActivity.this.clicked(i);</code></li>
<li>然后对OK和del按钮进行初始化并设置点击事件分别为 <code>MainActivity.this.ok_clicked();</code> 和 <code>MainActivity.this.del_clicked();</code></li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">clicked</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">    DebugTools.<span class="built_in">log</span>(<span class="string">&quot;number: &quot;</span> + i);</span><br><span class="line">    <span class="keyword">this</span>.mScreen.<span class="built_in">setText</span>(<span class="keyword">this</span>.mScreen.<span class="built_in">getText</span>().<span class="built_in">append</span>((CharSequence) Integer.<span class="built_in">toString</span>(i)));</span><br><span class="line">    DebugTools.<span class="built_in">log</span>(<span class="string">&quot;current Pass: &quot;</span> + ((Object) <span class="keyword">this</span>.mScreen.<span class="built_in">getText</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击按钮时候会先log记录下来，然后再将数字转为String显示到屏幕上，然后再log记录下当前的passwd</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="type">void</span> <span class="title">ok_clicked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DebugTools.<span class="built_in">log</span>(<span class="string">&quot;clicked password: &quot;</span> + ((Object) <span class="keyword">this</span>.mScreen.<span class="built_in">getText</span>()));</span><br><span class="line">    boolean result = Verify.<span class="built_in">isOk</span>(<span class="keyword">this</span>, <span class="keyword">this</span>.mScreen.<span class="built_in">getText</span>().<span class="built_in">toString</span>());</span><br><span class="line">    DebugTools.<span class="built_in">log</span>(<span class="string">&quot;password is Ok? : &quot;</span> + result);</span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">        Intent i = <span class="keyword">new</span> <span class="built_in">Intent</span>(<span class="keyword">this</span>, (Class&lt;?&gt;) LipSum.<span class="keyword">class</span>);</span><br><span class="line">        Bundle b = <span class="keyword">new</span> <span class="built_in">Bundle</span>();</span><br><span class="line">        b.<span class="built_in">putString</span>(<span class="string">&quot;flag&quot;</span>, <span class="keyword">this</span>.mScreen.<span class="built_in">getText</span>().<span class="built_in">toString</span>().<span class="built_in">substring</span>(<span class="number">0</span>, <span class="number">7</span>));</span><br><span class="line">        i.<span class="built_in">putExtras</span>(b);</span><br><span class="line">        <span class="built_in">startActivity</span>(i);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Toast.<span class="built_in">makeText</span>(<span class="keyword">this</span>, R.string.wrong, <span class="number">1</span>).<span class="built_in">show</span>();</span><br><span class="line">    <span class="keyword">this</span>.mScreen.<span class="built_in">setText</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击OK按钮，会先log记录当前的passwd，然后通过Verify.isOk对其进行check，如果密码正确会进入到分支，然后会把flag放到屏幕上，显然这就是胜利条件了</p>
<p>第一个idea，对isOk进行hook，测试之后发现，他的flag是md5的密码，显然偷鸡失败（&#x2F;(ㄒoㄒ)&#x2F;~~</p>
<p>那么就要研究isOk函数的逻辑：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="type">static</span> boolean <span class="title">isOk</span><span class="params">(Context c, String _password)</span> </span>&#123;</span><br><span class="line">    String password = _password;</span><br><span class="line">    <span class="keyword">if</span> (_password.<span class="built_in">length</span>() &gt; <span class="number">7</span>) &#123;</span><br><span class="line">        password = _password.<span class="built_in">substring</span>(<span class="number">0</span>, <span class="number">7</span>); <span class="comment">// 只取前7个数字</span></span><br><span class="line">    &#125;</span><br><span class="line">    String r = <span class="built_in">OneWayFunction</span>(password);</span><br><span class="line">    DebugTools.<span class="built_in">log</span>(<span class="string">&quot;digest: &quot;</span> + password + <span class="string">&quot; =&gt; &quot;</span> + r);</span><br><span class="line">    <span class="keyword">return</span> r.<span class="built_in">equals</span>(<span class="string">&quot;be790d865f2cea9645b3f79c0342df7e&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>password只取前7个数字进OneWayFunction函数，之后将其返回的值与一个hash进行比对</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="type">static</span> String <span class="title">OneWayFunction</span><span class="params">(<span class="keyword">final</span> String password)</span> </span>&#123;</span><br><span class="line">    String[] hashes = &#123;<span class="string">&quot;MD2&quot;</span>, <span class="string">&quot;MD5&quot;</span>, <span class="string">&quot;SHA-1&quot;</span>, <span class="string">&quot;SHA-256&quot;</span>, <span class="string">&quot;SHA-384&quot;</span>, <span class="string">&quot;SHA-512&quot;</span>&#125;;</span><br><span class="line">    List&lt;byte[]&gt; bytes = ArrayTools.<span class="built_in">map</span>(ArrayTools.<span class="built_in">select</span>(ArrayTools.<span class="built_in">map</span>(hashes, <span class="keyword">new</span> <span class="built_in">MapAction</span>&lt;String, byte[]&gt;() &#123; <span class="comment">// from class: io.asis.ctf2014.numdriod.Verify.1</span></span><br><span class="line">        @Override <span class="comment">// io.asis.ctf2014.numdriod.tools.MapAction</span></span><br><span class="line">            <span class="keyword">public</span> byte[] <span class="built_in">action</span>(String element) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                MessageDigest digest = MessageDigest.<span class="built_in">getInstance</span>(element);</span><br><span class="line">                digest.<span class="built_in">update</span>(password.<span class="built_in">getBytes</span>());</span><br><span class="line">                <span class="keyword">return</span> digest.<span class="built_in">digest</span>();</span><br><span class="line">            &#125; <span class="built_in">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">                <span class="keyword">return</span> null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;), <span class="keyword">new</span> <span class="built_in">SelectAction</span>&lt;byte[]&gt;() &#123; <span class="comment">// from class: io.asis.ctf2014.numdriod.Verify.2</span></span><br><span class="line">        @Override <span class="comment">// io.asis.ctf2014.numdriod.tools.SelectAction</span></span><br><span class="line">            <span class="keyword">public</span> boolean <span class="built_in">action</span>(byte[] element) &#123;</span><br><span class="line">            <span class="keyword">return</span> element != null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;), <span class="keyword">new</span> <span class="built_in">MapAction</span>&lt;byte[], byte[]&gt;() &#123; <span class="comment">// from class: io.asis.ctf2014.numdriod.Verify.3</span></span><br><span class="line">        @Override <span class="comment">// io.asis.ctf2014.numdriod.tools.MapAction</span></span><br><span class="line">            <span class="keyword">public</span> byte[] <span class="built_in">action</span>(byte[] element) &#123;</span><br><span class="line">            byte[] b = <span class="keyword">new</span> byte[<span class="number">8</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; b.length / <span class="number">2</span>; i++) &#123;</span><br><span class="line">                b[i] = element[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i2 = <span class="number">0</span>; i2 &lt; b.length / <span class="number">2</span>; i2++) &#123;</span><br><span class="line">                b[(b.length / <span class="number">2</span>) + i2] = element[(element.length - i2) - <span class="number">2</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    byte[] b2 = <span class="keyword">new</span> byte[bytes.<span class="built_in">size</span>() * <span class="number">8</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; b2.length; i++) &#123;</span><br><span class="line">        b2[i] = bytes.<span class="built_in">get</span>(i % bytes.<span class="built_in">size</span>())[i / bytes.<span class="built_in">size</span>()];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        MessageDigest digest = MessageDigest.<span class="built_in">getInstance</span>(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">        digest.<span class="built_in">update</span>(b2);</span><br><span class="line">        byte[] messageDigest = digest.<span class="built_in">digest</span>();</span><br><span class="line">        StringBuilder hexString = <span class="keyword">new</span> <span class="built_in">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (byte aMessageDigest : messageDigest) &#123;</span><br><span class="line">            String h = Integer.<span class="built_in">toHexString</span>(aMessageDigest &amp; <span class="number">255</span>);</span><br><span class="line">            <span class="keyword">while</span> (h.<span class="built_in">length</span>() &lt; <span class="number">2</span>) &#123;</span><br><span class="line">                h = <span class="string">&quot;0&quot;</span> + h;</span><br><span class="line">            &#125;</span><br><span class="line">            hexString.<span class="built_in">append</span>(h);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hexString.<span class="built_in">toString</span>();</span><br><span class="line">    &#125; <span class="built_in">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现hash基本都是单向的，发现如果只是爆破的话只有10^7的大小，感觉可以尝试</p>
<h3 id="方案1："><a href="#方案1：" class="headerlink" title="方案1："></a>方案1：</h3><p>网上师傅的方案：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">.line 26</span><br><span class="line">  :cond_0</span><br><span class="line">  const/4 v0, 0x0</span><br><span class="line"></span><br><span class="line">  .local v0, &quot;i&quot;:I</span><br><span class="line">  :goto_0</span><br><span class="line">  const v2, 0x98967f</span><br><span class="line"></span><br><span class="line">  if-lt v0, v2, :cond_1</span><br><span class="line"></span><br><span class="line">  .line 38</span><br><span class="line">  return-void</span><br><span class="line"></span><br><span class="line">  .line 28</span><br><span class="line">  :cond_1</span><br><span class="line">  invoke-static &#123;v0&#125;, Ljava/lang/Integer;-&gt;toString(I)Ljava/lang/String;</span><br><span class="line"></span><br><span class="line">  move-result-object v2</span><br><span class="line"></span><br><span class="line">  invoke-static &#123;v2&#125;, Lcom/example/forloop/MainActivity;-&gt;isOk(Ljava/lang/String;)Z</span><br><span class="line"></span><br><span class="line">  move-result v1</span><br><span class="line"></span><br><span class="line">  .line 29</span><br><span class="line">  .local v1, &quot;ok&quot;:Z</span><br><span class="line">  const v2, 0x186a0</span><br><span class="line"></span><br><span class="line">  rem-int v2, v0, v2</span><br><span class="line"></span><br><span class="line">  if-nez v2, :cond_2</span><br><span class="line"></span><br><span class="line">  .line 31</span><br><span class="line">  invoke-static &#123;v0&#125;, Ljava/lang/Integer;-&gt;toString(I)Ljava/lang/String;</span><br><span class="line"></span><br><span class="line">  move-result-object v2</span><br><span class="line"></span><br><span class="line">  invoke-virtual &#123;p0, v2&#125;, Lcom/example/forloop/MainActivity;-&gt;log(Ljava/lang/String;)V</span><br><span class="line"></span><br><span class="line">  .line 33</span><br><span class="line">  :cond_2</span><br><span class="line">  if-eqz v1, :cond_3</span><br><span class="line"></span><br><span class="line">  .line 35</span><br><span class="line">  invoke-static &#123;v0&#125;, Ljava/lang/Integer;-&gt;toString(I)Ljava/lang/String;</span><br><span class="line"></span><br><span class="line">  move-result-object v2</span><br><span class="line"></span><br><span class="line">  invoke-virtual &#123;p0, v2&#125;, Lcom/example/forloop/MainActivity;-&gt;log(Ljava/lang/String;)V</span><br><span class="line"></span><br><span class="line">  .line 26</span><br><span class="line">  :cond_3</span><br><span class="line">  add-int/lit8 v0, v0, 0x1</span><br><span class="line"></span><br><span class="line">  goto :goto_0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:cond_0</span><br><span class="line">const/4 v0, 0x0</span><br><span class="line"></span><br><span class="line">.local v0, &quot;i&quot;:I</span><br><span class="line">:goto_0</span><br></pre></td></tr></table></figure>

<p>这里首先初始化<code>v0=0</code>，然后初始化循环器i（存储在v0中）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const v2, 0x98967f       # 加载最大值 9,999,999 (0x98967F)</span><br><span class="line">if-lt v0, v2, :cond_1    # 如果 i &gt;= 9,999,999，跳转到 :cond_1（退出循环）</span><br></pre></td></tr></table></figure>

<p> <code>if v0 less than v2</code>（即<code>v0&lt;v2</code>）就会跳转到<code>cond_1</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">invoke-static &#123;v0&#125;, Ljava/lang/Integer;-&gt;toString(I)Ljava/lang/String;</span><br><span class="line">move-result-object v2     # 将 i 转为字符串</span><br><span class="line">invoke-static &#123;v2&#125;, Lcom/example/forloop/MainActivity;-&gt;isOk(Ljava/lang/String;)Z</span><br><span class="line">move-result v1            # 调用 isOk() 并存储结果到 v1(ok)</span><br></pre></td></tr></table></figure>

<p>v0转换为字符串，然后将结果存储到v2，之后调用isOk，参数是v2，然后将返回值放入v1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const v2, 0x186a0        # 加载 100,000 (0x186A0)</span><br><span class="line">rem-int v2, v0, v2       # 计算 i % 100,000</span><br><span class="line">if-nez v2, :cond_2       # 如果余数为0（每100,000次），执行打印</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印当前进度</span></span><br><span class="line">invoke-static &#123;v0&#125;, Ljava/lang/Integer;-&gt;toString(I)Ljava/lang/String;</span><br><span class="line">move-result-object v2</span><br><span class="line">invoke-virtual &#123;p0, v2&#125;, Lcom/example/forloop/MainActivity;-&gt;log(Ljava/lang/String;)V</span><br></pre></td></tr></table></figure>

<p><code>if v2 no equal zero</code>，就是<code>v2!=0</code>就会跳转到<code>cond_2</code>标签处执行，否则继续执行下一条指令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">:cond_2</span><br><span class="line">if-eqz v1, :cond_3       # 如果 isOk() 返回 true，执行成功逻辑</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印成功的数字</span></span><br><span class="line">invoke-static &#123;v0&#125;, Ljava/lang/Integer;-&gt;toString(I)Ljava/lang/String;</span><br><span class="line">move-result-object v2</span><br><span class="line">invoke-virtual &#123;p0, v2&#125;, Lcom/example/forloop/MainActivity;-&gt;log(Ljava/lang/String;)V</span><br></pre></td></tr></table></figure>

<p>如果<code>v1==0</code>就会打印成功的数字，调用的是log进行打印</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:cond_3</span><br><span class="line">add-int/lit8 v0, v0, 0x1  # i++</span><br><span class="line">goto :goto_0              # 跳回循环开头</span><br></pre></td></tr></table></figure>

<p>如果没满足，就执行<code>i++</code>然后跳转回去</p>
<p>但是为了将其粘贴到apk中就要对其进行修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">const/4 v0, 0x0</span><br><span class="line"></span><br><span class="line">.local v0, &quot;i&quot;:I</span><br><span class="line">:goto_3</span><br><span class="line">const v2, 0x98967f</span><br><span class="line"></span><br><span class="line">if-lt v0, v2, :cond_3</span><br><span class="line">return-void</span><br><span class="line"></span><br><span class="line">.line 28</span><br><span class="line">:cond_3</span><br><span class="line">invoke-static &#123;v0&#125;, Ljava/lang/Integer;-&gt;toString(I)Ljava/lang/String;</span><br><span class="line"></span><br><span class="line">move-result-object v2</span><br><span class="line"></span><br><span class="line">invoke-static &#123;p0, v2&#125;, Lio/asis/ctf2014/numdriod/Verify;-&gt;isOk(Landroid/content/Context;Ljava/lang/String;)Z</span><br><span class="line"></span><br><span class="line">move-result v1</span><br><span class="line"></span><br><span class="line">.line 29</span><br><span class="line">.local v1, &quot;ok&quot;:Z</span><br><span class="line"></span><br><span class="line">const v4, 0x186a0</span><br><span class="line"></span><br><span class="line">rem-int v4, v0, v4</span><br><span class="line"></span><br><span class="line">if-nez v4, :cond_6</span><br><span class="line"></span><br><span class="line">.line 31</span><br><span class="line">invoke-static &#123;v0&#125;, Ljava/lang/Integer;-&gt;toString(I)Ljava/lang/String;</span><br><span class="line"></span><br><span class="line">move-result-object v2</span><br><span class="line">invoke-static &#123;v2&#125;, Lio/asis/ctf2014/numdriod/tools/DebugTools;-&gt;log(Ljava/lang/String;)V</span><br><span class="line"></span><br><span class="line">:cond_6</span><br><span class="line"></span><br><span class="line">if-eqz v1, :cond_2</span><br><span class="line"></span><br><span class="line">goto :goto_4</span><br><span class="line">.line 31</span><br><span class="line">invoke-static &#123;v0&#125;, Ljava/lang/Integer;-&gt;toString(I)Ljava/lang/String;</span><br><span class="line"></span><br><span class="line">move-result-object v2</span><br><span class="line"></span><br><span class="line">invoke-static &#123;v2&#125;, Lio/asis/ctf2014/numdriod/tools/DebugTools;-&gt;log(Ljava/lang/String;)V</span><br><span class="line"></span><br><span class="line">.line 26</span><br><span class="line">:cond_2</span><br><span class="line">add-int/lit8 v0, v0, 0x1</span><br><span class="line"></span><br><span class="line">goto :goto_3</span><br></pre></td></tr></table></figure>

<h3 id="方案2："><a href="#方案2：" class="headerlink" title="方案2："></a>方案2：</h3><p>这个方案是直接将Verify中加个main函数，然后修改一些报错，直接运行即可，参照<a target="_blank" rel="noopener" href="https://gist.github.com/volpino/2edea8503822aefb4c9e">https://gist.github.com/volpino/2edea8503822aefb4c9e</a></p>
<p>得到答案是</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">................&gt; java .\sample\Verify.java</span><br><span class="line">FOUND!! 3130110</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/s1nec-1o/photo@main/img/202504141456731.png" alt="image-20250330220516717" style="zoom:50%;" />

<h2 id="2014-Sharif-University-Quals-CTF-Commercial-Application"><a href="#2014-Sharif-University-Quals-CTF-Commercial-Application" class="headerlink" title="2014 Sharif University Quals CTF Commercial Application"></a>2014 Sharif University Quals CTF Commercial Application</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="type">void</span> <span class="title">checkLicenceKey</span><span class="params">(<span class="keyword">final</span> Context context)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.app.<span class="built_in">getDataHelper</span>().<span class="built_in">getConfig</span>().<span class="built_in">hasLicence</span>()) &#123; <span class="comment">// 如果没有有效许可证</span></span><br><span class="line">          <span class="built_in">showAlertDialog</span>(context, OK_LICENCE_MSG);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      LayoutInflater li = LayoutInflater.<span class="built_in">from</span>(context);</span><br><span class="line">      View promptsView = li.<span class="built_in">inflate</span>(R.layout.propmt, (ViewGroup) null);</span><br><span class="line">      AlertDialog.Builder alertDialogBuilder = <span class="keyword">new</span> AlertDialog.<span class="built_in">Builder</span>(context);</span><br><span class="line">      alertDialogBuilder.<span class="built_in">setView</span>(promptsView);</span><br><span class="line">      <span class="keyword">final</span> EditText userInput = (EditText) promptsView.<span class="built_in">findViewById</span>(R.id.editTextDialogUserInput);</span><br><span class="line">      alertDialogBuilder.<span class="built_in">setCancelable</span>(<span class="literal">false</span>).<span class="built_in">setPositiveButton</span>(<span class="string">&quot;Continue&quot;</span>, <span class="keyword">new</span> DialogInterface.<span class="built_in">OnClickListener</span>() &#123; <span class="comment">// from class: edu.sharif.ctf.activities.MainActivity.4</span></span><br><span class="line">          @Override <span class="comment">// android.content.DialogInterface.OnClickListener</span></span><br><span class="line">          <span class="keyword">public</span> <span class="type">void</span> <span class="built_in">onClick</span>(DialogInterface dialog, <span class="type">int</span> id) &#123;</span><br><span class="line">              String userEnteredValue = userInput.<span class="built_in">getText</span>().<span class="built_in">toString</span>();</span><br><span class="line">              String storedKey = MainActivity.<span class="keyword">this</span>.app.<span class="built_in">getDataHelper</span>().<span class="built_in">getConfig</span>().<span class="built_in">getSecurityKey</span>();</span><br><span class="line">              String iv = MainActivity.<span class="keyword">this</span>.app.<span class="built_in">getDataHelper</span>().<span class="built_in">getConfig</span>().<span class="built_in">getSecurityIv</span>();</span><br><span class="line">              boolean licenceKeyIsValid = KeyVerifier.<span class="built_in">isValidLicenceKey</span>(userEnteredValue, storedKey, iv);</span><br><span class="line">              <span class="keyword">if</span> (licenceKeyIsValid) &#123;</span><br><span class="line">                  MainActivity.<span class="keyword">this</span>.app.<span class="built_in">getDataHelper</span>().<span class="built_in">updateLicence</span>(<span class="number">2014</span>);</span><br><span class="line">                  MainActivity.isRegisterd = <span class="literal">true</span>;</span><br><span class="line">                  MainActivity.<span class="keyword">this</span>.<span class="built_in">showAlertDialog</span>(context, MainActivity.OK_LICENCE_MSG);</span><br><span class="line">                  <span class="keyword">return</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              MainActivity.<span class="keyword">this</span>.<span class="built_in">showAlertDialog</span>(context, MainActivity.NOK_LICENCE_MSG);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;).<span class="built_in">setNegativeButton</span>(<span class="string">&quot;Cancel&quot;</span>, <span class="keyword">new</span> DialogInterface.<span class="built_in">OnClickListener</span>() &#123; <span class="comment">// from class: edu.sharif.ctf.activities.MainActivity.5</span></span><br><span class="line">          @Override <span class="comment">// android.content.DialogInterface.OnClickListener</span></span><br><span class="line">          <span class="keyword">public</span> <span class="type">void</span> <span class="built_in">onClick</span>(DialogInterface dialog, <span class="type">int</span> id) &#123;</span><br><span class="line">              dialog.<span class="built_in">cancel</span>();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      AlertDialog inputLicenceDialog = alertDialogBuilder.<span class="built_in">create</span>();</span><br><span class="line">      inputLicenceDialog.<span class="built_in">show</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>关键函数，处理key过程如下</p>
<p>按下continue之后，usrinput会被转为string进入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">userEnteredValue</span> <span class="operator">=</span> userInput.getText().toString();</span><br><span class="line"><span class="type">String</span> <span class="variable">storedKey</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>.app.getDataHelper().getConfig().getSecurityKey();</span><br><span class="line"><span class="type">String</span> <span class="variable">iv</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>.app.getDataHelper().getConfig().getSecurityIv();</span><br><span class="line"><span class="type">boolean</span> <span class="variable">licenceKeyIsValid</span> <span class="operator">=</span> KeyVerifier.isValidLicenceKey(userEnteredValue, storedKey, iv);</span><br></pre></td></tr></table></figure>

<p>会从配置中得到storedKey和iv，之后进入是否有效的判断</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> String CIPHER_ALGORITHM = <span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> String VALID_LICENCE = <span class="string">&quot;29a002d9340fc4bd54492f327269f3e051619b889dc8da723e135ce486965d84&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="type">static</span> boolean <span class="title">isValidLicenceKey</span><span class="params">(String userInput, String secretKey, String iv)</span> </span>&#123;</span><br><span class="line">    String encryptUserInputData = <span class="built_in">encrypt</span>(userInput, secretKey, iv);</span><br><span class="line">    <span class="keyword">return</span> encryptUserInputData.<span class="built_in">equals</span>(VALID_LICENCE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="type">static</span> String <span class="title">encrypt</span><span class="params">(String userInput, String secretKey, String iv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        SecretKeySpec secretKeySpec = <span class="keyword">new</span> <span class="built_in">SecretKeySpec</span>(<span class="built_in">hexStringToBytes</span>(secretKey), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        Cipher cipher = Cipher.<span class="built_in">getInstance</span>(CIPHER_ALGORITHM);</span><br><span class="line">        IvParameterSpec ivSpec = <span class="keyword">new</span> <span class="built_in">IvParameterSpec</span>(iv.<span class="built_in">getBytes</span>());</span><br><span class="line">        cipher.<span class="built_in">init</span>(<span class="number">1</span>, secretKeySpec, ivSpec);</span><br><span class="line">        byte[] encryptedBytes = cipher.<span class="built_in">doFinal</span>(userInput.<span class="built_in">getBytes</span>());</span><br><span class="line">        String encryptedText = <span class="built_in">bytesToHexString</span>(encryptedBytes);</span><br><span class="line">        <span class="keyword">return</span> encryptedText;</span><br><span class="line">    &#125; <span class="built_in">catch</span> (Exception e) &#123;</span><br><span class="line">        e.<span class="built_in">printStackTrace</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="type">static</span> String <span class="title">bytesToHexString</span><span class="params">(byte[] bytes)</span> </span>&#123;</span><br><span class="line">    StringBuilder sb = <span class="keyword">new</span> <span class="built_in">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">for</span> (byte b : bytes) &#123;</span><br><span class="line">        sb.<span class="built_in">append</span>(String.format(<span class="string">&quot;%02x&quot;</span>, Integer.<span class="built_in">valueOf</span>(b &amp; <span class="number">255</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sb.<span class="built_in">toString</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> byte[] <span class="built_in">hexStringToBytes</span>(String s) &#123;</span><br><span class="line">    <span class="type">int</span> len = s.<span class="built_in">length</span>();</span><br><span class="line">    byte[] data = <span class="keyword">new</span> byte[len / <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i += <span class="number">2</span>) &#123;</span><br><span class="line">        data[i / <span class="number">2</span>] = (byte) ((Character.<span class="built_in">digit</span>(s.<span class="built_in">charAt</span>(i), <span class="number">16</span>) &lt;&lt; <span class="number">4</span>) + Character.<span class="built_in">digit</span>(s.<span class="built_in">charAt</span>(i + <span class="number">1</span>), <span class="number">16</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>主要是通过encrypt函数进行加密，然后和invalid_license进行比较</p>
<p>在getconfig中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AppConfig <span class="title function_">getConfig</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">AppConfig</span> <span class="variable">agency</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AppConfig</span>();</span><br><span class="line">    <span class="type">Cursor</span> <span class="variable">cursor</span> <span class="operator">=</span> <span class="built_in">this</span>.myDataBase.rawQuery(SELECT_QUERY, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">if</span> (cursor.moveToFirst()) &#123;</span><br><span class="line">        agency.setId(cursor.getInt(<span class="number">0</span>));</span><br><span class="line">        agency.setName(cursor.getString(<span class="number">1</span>));</span><br><span class="line">        agency.setInstallDate(cursor.getString(<span class="number">2</span>));</span><br><span class="line">        agency.setValidLicence(cursor.getInt(<span class="number">3</span>) &gt; <span class="number">0</span>);</span><br><span class="line">        agency.setSecurityIv(cursor.getString(<span class="number">4</span>));</span><br><span class="line">        agency.setSecurityKey(cursor.getString(<span class="number">5</span>));</span><br><span class="line">        agency.setDesc(cursor.getString(<span class="number">7</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> agency;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现在这里设置了iv和Key</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Context myContext;</span><br><span class="line"><span class="keyword">private</span> SQLiteDatabase myDataBase;</span><br><span class="line"><span class="keyword">private</span> <span class="type">static</span> String DB_PATH = <span class="string">&quot;/data/data/edu.sharif.ctf/databases/&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="type">static</span> String DB_NAME = <span class="string">&quot;db.db&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="type">static</span> String TABLE_NAME = <span class="string">&quot;config&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> String UPDATE_QUERY = <span class="string">&quot;UPDATE &quot;</span> + TABLE_NAME + <span class="string">&quot; SET d=?&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> String SELECT_QUERY = <span class="string">&quot;SELECT  * FROM &quot;</span> + TABLE_NAME + <span class="string">&quot; WHERE a=1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>是从数据库中得到的，且有给出路径，那么直接</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb pull /data/data/edu.sharif.ctf/databases/db.db</span><br></pre></td></tr></table></figure>

<p>获得数据库，然后就能得到iv和Key了</p>
<img src="https://cdn.jsdelivr.net/gh/s1nec-1o/photo@main/img/202504141456733.png" alt="image-20250331151635178" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iv=a5efdbd57b84ca36 </span><br><span class="line">key=37eaae0141f1a3adf8a1dee655853714</span><br></pre></td></tr></table></figure>

<p>因为AES CBC是对称加密的，所以加解密的Key都是一样的</p>
<p>写个解密AES&#x2F;CBC&#x2F;PKCS5Padding的java类即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> String iv=<span class="string">&quot;a5efdbd57b84ca36&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> String Key=<span class="string">&quot;37eaae0141f1a3adf8a1dee655853714&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> String en_text=<span class="string">&quot;29a002d9340fc4bd54492f327269f3e051619b889dc8da723e135ce486965d84&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">static</span> <span class="type">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String data=<span class="built_in">decrypt</span>(en_text,Key,iv);</span><br><span class="line">        System.out.<span class="built_in">println</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">static</span> String <span class="title">decrypt</span><span class="params">(String paramString1, String paramString2, String paramString3)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SecretKeySpec localSecretKeySpec = <span class="keyword">new</span> <span class="built_in">SecretKeySpec</span>(<span class="built_in">hexStringToBytes</span>(paramString2), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            Cipher localCipher = Cipher.<span class="built_in">getInstance</span>(<span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">            localCipher.<span class="built_in">init</span>(Cipher.DECRYPT_MODE, localSecretKeySpec, <span class="keyword">new</span> <span class="built_in">IvParameterSpec</span>(paramString3.<span class="built_in">getBytes</span>()));</span><br><span class="line">            byte[] bytes = localCipher.<span class="built_in">doFinal</span>(<span class="built_in">hexStringToBytes</span>(paramString1));</span><br><span class="line">            String flag = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (byte b : bytes) &#123;</span><br><span class="line">                flag += (<span class="type">char</span>) b;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> flag;</span><br><span class="line">        &#125; <span class="built_in">catch</span> (Exception localException) &#123;</span><br><span class="line">            localException.<span class="built_in">printStackTrace</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">static</span> String <span class="title">bytesToHexString</span><span class="params">(byte[] bytes)</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> <span class="built_in">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (byte b : bytes) &#123;</span><br><span class="line">            sb.<span class="built_in">append</span>(String.format(<span class="string">&quot;%02x&quot;</span>, Integer.<span class="built_in">valueOf</span>(b &amp; <span class="number">255</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.<span class="built_in">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">static</span> byte[] <span class="built_in">hexStringToBytes</span>(String s) &#123;</span><br><span class="line">        <span class="type">int</span> len = s.<span class="built_in">length</span>();</span><br><span class="line">        byte[] data = <span class="keyword">new</span> byte[len / <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i += <span class="number">2</span>) &#123;</span><br><span class="line">            data[i / <span class="number">2</span>] = (byte) ((Character.<span class="built_in">digit</span>(s.<span class="built_in">charAt</span>(i), <span class="number">16</span>) &lt;&lt; <span class="number">4</span>) + Character.<span class="built_in">digit</span>(s.<span class="built_in">charAt</span>(i + <span class="number">1</span>), <span class="number">16</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>成功得到<code>fl-ag-IS-se-ri-al-NU-MB-ER</code></p>
<h2 id="2015-0CTF-vezel"><a href="#2015-0CTF-vezel" class="headerlink" title="2015-0CTF-vezel"></a>2015-0CTF-vezel</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(View v)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> getPackageName();</span><br><span class="line">    <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> String.valueOf(getSig(s));</span><br><span class="line">    <span class="type">String</span> <span class="variable">next</span> <span class="operator">=</span> getCrc();</span><br><span class="line">    <span class="type">String</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="string">&quot;0CTF&#123;&quot;</span> + first + next + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (flag.equals(<span class="built_in">this</span>.et.getText().toString())) &#123;</span><br><span class="line">        Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;Yes!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;0ops!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主要代码如上，发现是通过getSig和getCrc来拼接获得flag的</p>
<p>那么考虑直接hook getSig和getCrc获得对应的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(function() &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">MainActivity</span> <span class="operator">=</span> Java.use(<span class="string">&#x27;com.ctf.vezel.MainActivity&#x27;</span>);</span><br><span class="line">    MainActivity.getSig.implementation = function(packageName) &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.getSig(packageName);</span><br><span class="line">        console.log(<span class="string">&quot;Signature hashCode: &quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">    MainActivity.getCrc.implementation = function() &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.getCrc();</span><br><span class="line">        console.log(<span class="string">&quot;Crs: &quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Signature hashCode: <span class="number">-183971537</span></span><br><span class="line">Crs: <span class="number">1189242199</span></span><br></pre></td></tr></table></figure>

<p>得到flag为<code>0CTF&#123;-1839715371189242199&#125;</code></p>
<h2 id="2017-XMAN-HelloSmali2"><a href="#2017-XMAN-HelloSmali2" class="headerlink" title="2017 XMAN HelloSmali2"></a>2017 XMAN HelloSmali2</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.hellosmali.hellosmali;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: D:\android_re\CTF\wiki\hello\sec.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Digest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (input != <span class="literal">null</span> &amp;&amp; input.length() != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">char</span>[] charinput = input.toCharArray();</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">v2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">char</span> c : charinput) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">intinput</span> <span class="operator">=</span> Integer.toBinaryString(c);</span><br><span class="line">                <span class="keyword">while</span> (intinput.length() &lt; <span class="number">8</span>) &#123;</span><br><span class="line">                    intinput = <span class="string">&quot;0&quot;</span> + intinput;</span><br><span class="line">                &#125;</span><br><span class="line">                v2.append(intinput);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (v2.length() % <span class="number">6</span> != <span class="number">0</span>) &#123; <span class="comment">// 字符串的长度要是6的倍数</span></span><br><span class="line">                v2.append(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">v1</span> <span class="operator">=</span> String.valueOf(v2);</span><br><span class="line">            <span class="type">char</span>[] v4 = <span class="keyword">new</span> <span class="title class_">char</span>[v1.length() / <span class="number">6</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; v4.length; i++) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">v6</span> <span class="operator">=</span> Integer.parseInt(v1.substring(<span class="number">0</span>, <span class="number">6</span>), <span class="number">2</span>);</span><br><span class="line">                v1 = v1.substring(<span class="number">6</span>);</span><br><span class="line">                v4[i] = <span class="string">&quot;+/abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>.charAt(v6);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">v3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(String.valueOf(v4));</span><br><span class="line">            <span class="keyword">if</span> (input.length() % <span class="number">3</span> != <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (input.length() % <span class="number">3</span> == <span class="number">2</span>) &#123;</span><br><span class="line">                    v3.append(<span class="string">&quot;!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                v3.append(<span class="string">&quot;!?&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> String.valueOf(v3);</span><br><span class="line">            <span class="keyword">if</span> (key.equals(<span class="string">&quot;xsZDluYYreJDyrpDpucZCo!?&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>逆向函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">re1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        String key=<span class="string">&quot;xsZDluYYreJDyrpDpucZCo!?&quot;</span>;</span><br><span class="line">        String charset=<span class="string">&quot;+/abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>;</span><br><span class="line">        key=key.substring(<span class="number">0</span>,key.length()-<span class="number">2</span>);</span><br><span class="line">        System.out.println(key);</span><br><span class="line">        StringBuilder binary_string=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;key.length();i++)&#123;</span><br><span class="line">            <span class="type">char</span> c=key.charAt(i);</span><br><span class="line">            <span class="type">int</span> index=charset.indexOf(c);</span><br><span class="line">            String binary=String.format(<span class="string">&quot;%6s&quot;</span>,Integer.toBinaryString(index)).replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">            binary_string.append(binary);</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuilder result=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        String binary=binary_string.toString();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;binary.length();i+=<span class="number">8</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i+<span class="number">8</span>&gt;binary.length())&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String byteStr=binary.substring(i,i+<span class="number">8</span>);</span><br><span class="line">            <span class="type">int</span> charCode=Integer.parseInt(byteStr,<span class="number">2</span>);</span><br><span class="line">            result.append((<span class="type">char</span>)charCode);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xsZDluYYreJDyrpDpucZCo</span><br><span class="line">eM_5m4Li_i4_Ea5y</span><br></pre></td></tr></table></figure>

<p>得到结果</p>
<h1 id="静态分析原生层"><a href="#静态分析原生层" class="headerlink" title="静态分析原生层"></a>静态分析原生层</h1><h2 id="2015-海峡两岸-一个-APK，逆向试试吧"><a href="#2015-海峡两岸-一个-APK，逆向试试吧" class="headerlink" title="2015 - 海峡两岸 - 一个 APK，逆向试试吧"></a>2015 - 海峡两岸 - 一个 APK，逆向试试吧</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> native boolean <span class="title">testFlag</span><span class="params">(String str)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> &#123;</span><br><span class="line">    System.<span class="built_in">loadLibrary</span>(<span class="string">&quot;mobicrackNDK&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override <span class="comment">// android.support.v7.app.ActionBarActivity, android.support.v4.app.FragmentActivity, android.app.Activity</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="type">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    super.<span class="built_in">onCreate</span>(savedInstanceState);</span><br><span class="line">    <span class="built_in">setContentView</span>(R.layout.activity_crack_me);</span><br><span class="line">    <span class="keyword">this</span>.inputButton = (Button) <span class="built_in">findViewById</span>(R.id.input_button);</span><br><span class="line">    <span class="keyword">this</span>.pwdEditText = (EditText) <span class="built_in">findViewById</span>(R.id.pwd);</span><br><span class="line">    <span class="keyword">this</span>.inputButton.<span class="built_in">setOnClickListener</span>(<span class="keyword">new</span> View.<span class="built_in">OnClickListener</span>() &#123; <span class="comment">// from class: com.example.mobicrackndk.CrackMe.1</span></span><br><span class="line">        @Override <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">void</span> <span class="built_in">onClick</span>(View v) &#123;</span><br><span class="line">            CrackMe.<span class="keyword">this</span>.input = CrackMe.<span class="keyword">this</span>.pwdEditText.<span class="built_in">getText</span>().<span class="built_in">toString</span>();</span><br><span class="line">            <span class="keyword">if</span> (CrackMe.<span class="keyword">this</span>.input != null) &#123;</span><br><span class="line">                <span class="keyword">if</span> (CrackMe.<span class="keyword">this</span>.<span class="built_in">testFlag</span>(CrackMe.<span class="keyword">this</span>.input)) &#123;</span><br><span class="line">                    Toast.<span class="built_in">makeText</span>(CrackMe.<span class="keyword">this</span>, CrackMe.<span class="keyword">this</span>.input, <span class="number">1</span>).<span class="built_in">show</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Toast.<span class="built_in">makeText</span>(CrackMe.<span class="keyword">this</span>, <span class="string">&quot;Wrong flag&quot;</span>, <span class="number">1</span>).<span class="built_in">show</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不难看出，testFlag就是核心的函数，加载的mobicrackNDK</p>
<p>但是so文件dump下来直接搜索符号是没有的，因此考虑寻找<code>JNI_Onload</code>函数（通过 <code>JNI_OnLoad</code> 动态注册）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">jint <span class="title">JNI_OnLoad</span><span class="params">(JavaVM *vm, <span class="type">void</span> *reserved)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// r5</span></span><br><span class="line">  <span class="type">char</span> *v4; <span class="comment">// r7</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// r1</span></span><br><span class="line">  FILE *stream; <span class="comment">// [sp+4h] [bp-24h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [sp+Ch] [bp-1Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;JNI_OnLoad&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (*vm)-&gt;<span class="built_in">GetEnv</span>(vm, (<span class="type">void</span> **)&amp;v8, <span class="number">65540</span>) )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">  v3 = v8;</span><br><span class="line">  v4 = classPathName[<span class="number">0</span>];</span><br><span class="line">  stream = (FILE *)((<span class="type">char</span> *)&amp;_sF + <span class="number">168</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>((FILE *)((<span class="type">char</span> *)&amp;_sF + <span class="number">168</span>), <span class="string">&quot;RegisterNatives start for &#x27;%s&#x27;&quot;</span>, classPathName[<span class="number">0</span>]);</span><br><span class="line">  v5 = (*(<span class="built_in">int</span> (__fastcall **)(<span class="type">int</span>, <span class="type">char</span> *))(*(_DWORD *)v3 + <span class="number">24</span>))(v3, v4);</span><br><span class="line">  <span class="keyword">if</span> ( !v5 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(stream, <span class="string">&quot;Native registration unable to find class &#x27;%s&#x27;&quot;</span>, v4);</span><br><span class="line">LABEL_6:</span><br><span class="line">    <span class="built_in">fputs</span>(<span class="string">&quot;GetEnv failed&quot;</span>, (FILE *)((<span class="type">char</span> *)&amp;_sF + <span class="number">168</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (*(<span class="built_in">int</span> (__fastcall **)(<span class="type">int</span>, <span class="type">int</span>, <span class="type">char</span> **, <span class="type">int</span>))(*(_DWORD *)v3 + <span class="number">860</span>))(v3, v5, off_400C, <span class="number">2</span>) &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(stream, <span class="string">&quot;RegisterNatives failed for &#x27;%s&#x27;&quot;</span>, v4);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">65540</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( (*(<span class="built_in">int</span> (__fastcall **)(<span class="type">int</span>, <span class="type">int</span>, <span class="type">char</span> **, <span class="type">int</span>))(*(_DWORD *)v3 + <span class="number">860</span>))(v3, v5, off_400C, <span class="number">2</span>) &lt; <span class="number">0</span> )</span><br></pre></td></tr></table></figure>

<p>这就是注册的函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.data:<span class="number">0000400</span>C off_400C        DCD aTestflag           ; DATA XREF: JNI_OnLoad+<span class="number">60</span>↑o</span><br><span class="line">.data:<span class="number">0000400</span>C                                         ; JNI_OnLoad+<span class="number">68</span>↑o ...</span><br><span class="line">.data:<span class="number">0000400</span>C                                         ; <span class="string">&quot;testFlag&quot;</span></span><br><span class="line">.data:<span class="number">00004010</span>                 DCD aLjavaLangStrin_0   ; <span class="string">&quot;(Ljava/lang/String;)Z&quot;</span></span><br><span class="line">.data:<span class="number">00004014</span>                 DCD abcdefghijklmn+<span class="number">1</span></span><br><span class="line">.data:<span class="number">00004018</span>                 DCD aHello              ; <span class="string">&quot;hello&quot;</span></span><br><span class="line">.data:<span class="number">0000401</span>C                 DCD aLjavaLangStrin_1   ; <span class="string">&quot;()Ljava/lang/String;&quot;</span></span><br><span class="line">.data:<span class="number">00004020</span>                 DCD native_hello+<span class="number">1</span></span><br><span class="line">.data:<span class="number">00004020</span> ; .data         ends</span><br></pre></td></tr></table></figure>

<p>可以看到testFlag就是abcdefghijklmn函数，第二个参数括弧里的是参数，括弧外的是返回值的类型，可以看到testFlag函数的参数类型是String，参数返回类型是bool型</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> __fastcall <span class="title">abcdefghijklmn</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>a1</code>：<code>JNIEnv*</code> 指针（通过 <code>jniEnv</code> 全局变量缓存）</li>
<li><code>a2</code>：未使用</li>
<li><code>a3</code>：输入的 Java 字符串对象（<code>jstring</code>）</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> __fastcall <span class="title">abcdefghijklmn</span><span class="params">(JNIEnv *a1, <span class="type">int</span> a2, <span class="type">void</span> *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">size_t</span> i; <span class="comment">// r6</span></span><br><span class="line">  jmethodID v7; <span class="comment">// r2</span></span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">_jfieldID</span> *key; <span class="comment">// r4</span></span><br><span class="line">  jobject v9; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v10; <span class="comment">// r5</span></span><br><span class="line">  jclass v12; <span class="comment">// [sp+4h] [bp-C4h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *user_input; <span class="comment">// [sp+8h] [bp-C0h]</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">12</span>]; <span class="comment">// [sp+14h] [bp-B4h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v15[<span class="number">140</span>]; <span class="comment">// [sp+20h] [bp-A8h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( !jniEnv )</span><br><span class="line">    jniEnv = a1;                                <span class="comment">// 缓存JNIEnv指针</span></span><br><span class="line">  <span class="built_in">memset</span>(&amp;v15[<span class="number">12</span>], <span class="number">0</span>, <span class="number">0x80</span>u);</span><br><span class="line">  user_input = (*jniEnv)-&gt;<span class="built_in">GetStringUTFChars</span>(jniEnv, a3, <span class="number">0</span>);<span class="comment">// 将java字符串转为c字符串</span></span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(user_input) == <span class="number">0x10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i != <span class="number">8</span>; ++i )</span><br><span class="line">      s2[i] = user_input[i] - i;                <span class="comment">// 前8个字符减去索引值</span></span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    s2[<span class="number">8</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(seed[<span class="number">0</span>], s2) )                 <span class="comment">// 与seed[0]比较</span></span><br><span class="line">    &#123;</span><br><span class="line">      v12 = (*jniEnv)-&gt;<span class="built_in">FindClass</span>(jniEnv, <span class="string">&quot;com/example/mobicrackndk/Calc&quot;</span>);<span class="comment">// 加载这个类</span></span><br><span class="line">      <span class="keyword">if</span> ( !v12 )</span><br><span class="line">      &#123;</span><br><span class="line">        _android_log_print(<span class="number">4</span>, <span class="string">&quot;log&quot;</span>, <span class="string">&quot;class,failed&quot;</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_11;</span><br><span class="line">      &#125;</span><br><span class="line">      v7 = (*jniEnv)-&gt;<span class="built_in">GetStaticMethodID</span>(jniEnv, v12, <span class="string">&quot;calcKey&quot;</span>, <span class="string">&quot;()V&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( !v7 )</span><br><span class="line">      &#123;</span><br><span class="line">        _android_log_print(<span class="number">4</span>, <span class="string">&quot;log&quot;</span>, <span class="string">&quot;method,failed&quot;</span>);</span><br><span class="line">LABEL_11:</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      _JNIEnv::<span class="built_in">CallStaticVoidMethod</span>(jniEnv, v12, v7);<span class="comment">// 调用 Java 层的 Calc.calcKey() 方法</span></span><br><span class="line">      key = (*a1)-&gt;<span class="built_in">GetStaticFieldID</span>(a1, v12, <span class="string">&quot;key&quot;</span>, <span class="string">&quot;Ljava/lang/String;&quot;</span>);<span class="comment">// 获取该静态字段的jfieldID</span></span><br><span class="line">      <span class="keyword">if</span> ( !key )</span><br><span class="line">        _android_log_print(<span class="number">4</span>, <span class="string">&quot;log&quot;</span>, <span class="string">&quot;fid,failed&quot;</span>);</span><br><span class="line">      v9 = (*a1)-&gt;<span class="built_in">GetStaticObjectField</span>(a1, v12, key);<span class="comment">// 获取目标类的静态字段值</span></span><br><span class="line">      v10 = (*jniEnv)-&gt;<span class="built_in">GetStringUTFChars</span>(jniEnv, v9, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">while</span> ( i &lt; <span class="built_in">strlen</span>(v10) + <span class="number">8</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        s2[i + <span class="number">4</span>] = user_input[i] - i;          <span class="comment">// s2[i+4]其实就是v15[i]</span></span><br><span class="line">        ++i;</span><br><span class="line">      &#125;</span><br><span class="line">      v15[<span class="number">8</span>] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">strcmp</span>(v10, v15) == <span class="number">0</span>; <span class="comment">//与key进行比较</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>逆向得到，我们的输入的前八个字节减去索引要与seed[0]相等，后八个字节减去索引要与key相同</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package com.example.mobicrackndk;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calc</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">static</span> String key;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">static</span> <span class="type">void</span> <span class="title">calcKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> <span class="built_in">StringBuffer</span>(<span class="string">&quot;c7^WVHZ,&quot;</span>);</span><br><span class="line">        key = sb.<span class="built_in">reverse</span>().<span class="built_in">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>key=&quot;,ZHVW^7c&quot;</code></p>
<p>所以写个脚本即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">My</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">static</span> <span class="type">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String key = <span class="string">&quot;QflMn`fH,ZHVW^7c&quot;</span>;</span><br><span class="line">        <span class="type">char</span>[] chars = key.<span class="built_in">toCharArray</span>();</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> <span class="built_in">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; chars.length; i++) &#123;</span><br><span class="line">            result.<span class="built_in">append</span>((<span class="type">char</span>)(chars[i] + i));  <span class="comment">// 每个字符减去索引值</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(result.<span class="built_in">toString</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是wp说这是错误的</p>
<p>发现是在<code>_init_my</code>中存在对seed的修改</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> _init_my()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> i; <span class="comment">// r7</span></span><br><span class="line">  <span class="type">size_t</span> result; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="built_in">strlen</span>(seed[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= result )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    t[i] = seed[<span class="number">0</span>][i] - <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  seed[<span class="number">0</span>] = t;</span><br><span class="line">  byte_4038 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>都减了3，对脚本进行修改</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">My</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">static</span> <span class="type">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String key = <span class="string">&quot;QflMn`fH,ZHVW^7c&quot;</span>;</span><br><span class="line">        <span class="type">char</span>[] chars = key.<span class="built_in">toCharArray</span>();</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> <span class="built_in">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; chars.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;<span class="number">8</span>)&#123;</span><br><span class="line">                chars[i]-=<span class="number">3</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            result.<span class="built_in">append</span>((<span class="type">char</span>)(chars[i] + i));  <span class="comment">// 每个字符减去索引值</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(result.<span class="built_in">toString</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NdkMobiL4cRackEr</span><br></pre></td></tr></table></figure>

<p>成功</p>
<h1 id="静态分析综合题目"><a href="#静态分析综合题目" class="headerlink" title="静态分析综合题目"></a>静态分析综合题目</h1><h2 id="2017-ISCC-Crackone"><a href="#2017-ISCC-Crackone" class="headerlink" title="2017 ISCC Crackone"></a>2017 ISCC Crackone</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="type">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">     super.<span class="built_in">onCreate</span>(savedInstanceState);</span><br><span class="line">     <span class="built_in">setContentView</span>(R.layout.activity_main);</span><br><span class="line">     <span class="keyword">this</span>.editFlag = (EditText) <span class="built_in">findViewById</span>(R.id.textView3);</span><br><span class="line">     <span class="keyword">this</span>.button = (Button) <span class="built_in">findViewById</span>(R.id.button);</span><br><span class="line">     <span class="keyword">this</span>.button.<span class="built_in">setOnClickListener</span>(<span class="keyword">new</span> View.<span class="built_in">OnClickListener</span>() &#123; <span class="comment">// from class: org.isclab.iscc.MainActivity.1</span></span><br><span class="line">         @Override <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">         <span class="keyword">public</span> <span class="type">void</span> <span class="built_in">onClick</span>(View v) &#123;</span><br><span class="line">             String flag = Digest.<span class="built_in">encode</span>(MainActivity.<span class="keyword">this</span>.editFlag.<span class="built_in">getText</span>().<span class="built_in">toString</span>()).<span class="built_in">trim</span>();</span><br><span class="line">             Log.<span class="built_in">i</span>(<span class="string">&quot;ISCC&quot;</span>, flag);</span><br><span class="line">             <span class="type">int</span> result = MainActivity.<span class="keyword">this</span>.<span class="built_in">checkFlag</span>(flag.<span class="built_in">getBytes</span>(), flag.<span class="built_in">length</span>());</span><br><span class="line">             <span class="keyword">if</span> (result == <span class="number">1</span>) &#123;</span><br><span class="line">                 Toast.<span class="built_in">makeText</span>(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;Flag验证成功！&quot;</span>, <span class="number">0</span>).<span class="built_in">show</span>();</span><br><span class="line">             &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                 Toast.<span class="built_in">makeText</span>(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;Flag验证失败！&quot;</span>, <span class="number">0</span>).<span class="built_in">show</span>();</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>checkFlag为核心函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BOOL4 __cdecl <span class="title">native_checkFlag</span><span class="params">(JNIEnv *a1, <span class="type">int</span> a2, <span class="type">void</span> *usrinput, <span class="type">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> *usrinput_arr; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">int</span> idx; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> *end; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> tmp; <span class="comment">// [esp+2Bh] [ebp-21h]</span></span><br><span class="line">  jbyte *src; <span class="comment">// [esp+2Ch] [ebp-20h]</span></span><br><span class="line"></span><br><span class="line">  src = (jbyte *)<span class="built_in">malloc</span>(size);</span><br><span class="line">  (*a1)-&gt;<span class="built_in">GetByteArrayRegion</span>(a1, usrinput, <span class="number">0</span>, size, src);</span><br><span class="line">  usrinput_arr = (<span class="type">char</span> *)<span class="built_in">malloc</span>(size + <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">memset</span>(usrinput_arr, <span class="number">0</span>, size + <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">memcpy</span>(usrinput_arr, src, size);</span><br><span class="line">  <span class="keyword">if</span> ( size / <span class="number">2</span> &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    idx = <span class="number">0</span>;</span><br><span class="line">    end = &amp;usrinput_arr[size];</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      tmp = usrinput_arr[idx] - <span class="number">5</span>;</span><br><span class="line">      usrinput_arr[idx++] = *(end - <span class="number">1</span>);</span><br><span class="line">      *--end = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( idx != size / <span class="number">2</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  usrinput_arr[size] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">free</span>(usrinput_arr);</span><br><span class="line">  <span class="built_in">free</span>(src);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strcmp</span>(usrinput_arr, <span class="string">&quot;=0HWYl1SE5UQWFfN?I+PEo.UcshU&quot;</span>) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>逆向得到脚本：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">My</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">key</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="string">&quot;=0HWYl1SE5UQWFfN?I+PEo.UcshU&quot;</span>);</span><br><span class="line">        String re_key=key.reverse().toString();</span><br><span class="line">        <span class="type">char</span>[] chars = re_key.toCharArray();</span><br><span class="line">        <span class="type">int</span> idx=re_key.length();</span><br><span class="line">        StringBuffer result=<span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;idx;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;idx/<span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                result.append((<span class="type">char</span>)(chars[i]+<span class="number">5</span>));</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            result.append(chars[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3tJU0NDSkFWQU5ES1lYWH0=</span><br></pre></td></tr></table></figure>

<p>但是在进入checkFlag之前，还对其进行了编码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">package org.isclab.iscc;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Digest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;Util/Digest&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">static</span> String str = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">static</span> String <span class="title">encode</span><span class="params">(String srcStr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (srcStr != null &amp;&amp; srcStr.<span class="built_in">length</span>() != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">char</span>[] srcStrCh = srcStr.<span class="built_in">toCharArray</span>();</span><br><span class="line">            StringBuilder asciiBinStrB = <span class="keyword">new</span> <span class="built_in">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">char</span> c : srcStrCh) &#123;</span><br><span class="line">                String asciiBin = Integer.<span class="built_in">toBinaryString</span>(c);</span><br><span class="line">                <span class="keyword">while</span> (asciiBin.<span class="built_in">length</span>() &lt; <span class="number">8</span>) &#123;</span><br><span class="line">                    asciiBin = <span class="string">&quot;0&quot;</span> + asciiBin;</span><br><span class="line">                &#125;</span><br><span class="line">                asciiBinStrB.<span class="built_in">append</span>(asciiBin);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (asciiBinStrB.<span class="built_in">length</span>() % <span class="number">6</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                asciiBinStrB.<span class="built_in">append</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            String asciiBinStr = String.<span class="built_in">valueOf</span>(asciiBinStrB);</span><br><span class="line">            <span class="type">char</span>[] codeCh = <span class="keyword">new</span> <span class="type">char</span>[asciiBinStr.<span class="built_in">length</span>() / <span class="number">6</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; codeCh.length; i++) &#123;</span><br><span class="line">                <span class="type">int</span> index = Integer.<span class="built_in">parseInt</span>(asciiBinStr.<span class="built_in">substring</span>(<span class="number">0</span>, <span class="number">6</span>), <span class="number">2</span>);</span><br><span class="line">                asciiBinStr = asciiBinStr.<span class="built_in">substring</span>(<span class="number">6</span>);</span><br><span class="line">                codeCh[i] = str.<span class="built_in">charAt</span>(index);</span><br><span class="line">            &#125;</span><br><span class="line">            StringBuilder code = <span class="keyword">new</span> <span class="built_in">StringBuilder</span>(String.<span class="built_in">valueOf</span>(codeCh));</span><br><span class="line">            <span class="keyword">if</span> (srcStr.<span class="built_in">length</span>() % <span class="number">3</span> == <span class="number">1</span>) &#123;</span><br><span class="line">                code.<span class="built_in">append</span>(<span class="string">&quot;==&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (srcStr.<span class="built_in">length</span>() % <span class="number">3</span> == <span class="number">2</span>) &#123;</span><br><span class="line">                code.<span class="built_in">append</span>(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i2 = <span class="number">76</span>; i2 &lt; code.<span class="built_in">length</span>(); i2 += <span class="number">76</span>) &#123;</span><br><span class="line">                code.<span class="built_in">insert</span>(i2, <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            code.<span class="built_in">append</span>(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> String.<span class="built_in">valueOf</span>(code);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> srcStr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单分析，可以发现是标准base64，就不用自己写脚本了，cyberchef得到</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;ISCCJAVANDKYXX&#125;</span><br></pre></td></tr></table></figure>

<p>成功</p>
<h2 id="2018-强网杯-picture-lock"><a href="#2018-强网杯-picture-lock" class="headerlink" title="2018 强网杯 picture lock"></a>2018 强网杯 picture lock</h2><p>在android中，<code>onActivityResult</code>是一个<code>android.app.Activity</code>类预先定义好的回调函数，只有当内部方法调用<code>startActivityForResult(Intent intent, int requestCode)</code>来启动另一个Activity的时候才会调用这个回调函数，被启动的Activity必须在结束前调用setResult来设置返回结果和finish来关闭自己，关闭完之后原Activity就会调用<code>onActivityResult</code>方法，并将之前启动的Activity的resultCode和intent以及一开始调用新Activity传入的requestCode一起传入<code>onActivityResult</code></p>
<p>MediaStore内容提供器中，<code>_data</code>代表绝对路径</p>
<p><strong>逆向分析：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">j</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123; <span class="comment">// 获取该包的签名信息</span></span><br><span class="line">        Signature[] signatureArr = getPackageManager().getPackageInfo(<span class="string">&quot;com.a.sample.picturelock&quot;</span>, <span class="number">64</span>).signatures; <span class="comment">// 获取该包的签名信息</span></span><br><span class="line">        <span class="type">MessageDigest</span> <span class="variable">messageDigest</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>); <span class="comment">// 初始化MD5计算器</span></span><br><span class="line">        <span class="keyword">for</span> (Signature signature : signatureArr) &#123;</span><br><span class="line">            messageDigest.update(signature.toByteArray()); <span class="comment">// 遍历所有签名并更新哈希值</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">byte</span>[] digest = messageDigest.digest(); <span class="comment">// 最终md5哈希</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">byte</span> b : digest) &#123; <span class="comment">// 将字节数组转换为十六进制字符串</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> b &amp; <span class="number">255</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; <span class="number">16</span>) &#123;</span><br><span class="line">                sb.append(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(Integer.toHexString(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString(); <span class="comment">// 返回string</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (PackageManager.NameNotFoundException | NoSuchAlgorithmException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span> <span class="comment">// android.support.v4.a.k, android.app.Activity</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onActivityResult</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> i2, Intent intent)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onActivityResult(i, i2, intent);</span><br><span class="line">    <span class="keyword">switch</span> (i) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> (intent != <span class="literal">null</span>) &#123;</span><br><span class="line">                String[] strArr = &#123;<span class="string">&quot;_data&quot;</span>&#125;;</span><br><span class="line">                <span class="type">Cursor</span> <span class="variable">query</span> <span class="operator">=</span> getContentResolver().query(intent.getData(), strArr, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">                query.moveToFirst();</span><br><span class="line">                <span class="type">String</span> <span class="variable">file_path</span> <span class="operator">=</span> query.getString(query.getColumnIndex(strArr[<span class="number">0</span>])); <span class="comment">// 源文件路径</span></span><br><span class="line">                query.close();</span><br><span class="line">                enc(file_path, getFilesDir().getAbsolutePath() + file_path.substring(file_path.lastIndexOf(<span class="string">&quot;/&quot;</span>)) + <span class="string">&quot;.lock&quot;</span>, j());</span><br><span class="line">                i();</span><br><span class="line">                Toast.makeText(<span class="built_in">this</span>, String.format(<span class="string">&quot;%s encrypting&quot;</span>, file_path), <span class="number">1</span>).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span> <span class="comment">// android.support.v7.app.c, android.support.v4.a.k, android.app.Activity</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle bundle)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(bundle);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    findViewById(R.id.encrypt).setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: com.a.sample.picturelock.MainActivity.1</span></span><br><span class="line">        <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (a.a(<span class="built_in">this</span>, <span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span>) != <span class="number">0</span>) &#123; <span class="comment">// 判断是否有写入外部存储权限</span></span><br><span class="line">                android.support.v4.a.a.a((Activity) <span class="built_in">this</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span>&#125;, <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;android.intent.action.PICK&quot;</span>, (Uri) <span class="literal">null</span>); <span class="comment">// 动作</span></span><br><span class="line">            intent.setDataAndType(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, <span class="string">&quot;image/*&quot;</span>); <span class="comment">// 间接调用了MediaStore内容提供器</span></span><br><span class="line">            MainActivity.<span class="built_in">this</span>.startActivityForResult(intent, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    findViewById(R.id.refresh).setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: com.a.sample.picturelock.MainActivity.2</span></span><br><span class="line">        <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">            MainActivity.<span class="built_in">this</span>.i();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    i();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>看native层的enc函数 参数(文件的真实路径，目标路径，文件签名的md5)，第三个参数可以hook看一眼即可得到：<code>f8c49056e4ccf9a11e090eaf471f418d</code></p>
<p>不hook也可以直接得到</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">PS D:\android_re\CTF\wiki\picture&gt; apksigner verify --verbose --print-certs picturelock.<span class="function">apk</span></span><br><span class="line"><span class="function">Verifies</span></span><br><span class="line"><span class="function">Verified <span class="keyword">using</span> v1 <span class="title">scheme</span> <span class="params">(JAR signing)</span>: true</span></span><br><span class="line"><span class="function">Verified using v2 scheme (APK Signature Scheme v2): true</span></span><br><span class="line"><span class="function">Verified using v3 scheme (APK Signature Scheme v3): false</span></span><br><span class="line"><span class="function">Verified using v3<span class="number">.1</span> scheme (APK Signature Scheme v3<span class="number">.1</span>): false</span></span><br><span class="line"><span class="function">Verified using v4 scheme (APK Signature Scheme v4): false</span></span><br><span class="line"><span class="function">Verified for SourceStamp: false</span></span><br><span class="line"><span class="function">Number of signers: <span class="number">1</span></span></span><br><span class="line"><span class="function">Signer #<span class="number">1</span> certificate DN: CN=</span>a, OU=b, O=c, L=d, ST=e, C=ff</span><br><span class="line">Signer #<span class="number">1</span> certificate SHA<span class="number">-256</span> digest: ba12c13fd60e0def17ae3aee4e6a816782d0367ff02e37ccad5d6e86870c8e38</span><br><span class="line">Signer #<span class="number">1</span> certificate SHA<span class="number">-1</span> digest: <span class="number">48e7045</span>ee60d9d8a257c5275e3650609a5cca13e</span><br><span class="line">Signer #<span class="number">1</span> certificate MD5 digest: f8c49056e4ccf9a11e090eaf471f418d</span><br><span class="line">Signer #<span class="number">1</span> key algorithm: RSA</span><br><span class="line">Signer #<span class="number">1</span> key <span class="built_in">size</span> (bits): <span class="number">2048</span></span><br><span class="line">Signer #<span class="number">1</span> <span class="keyword">public</span> key SHA<span class="number">-256</span> digest: <span class="number">4</span>de55872bc804bf5fccc61c6e42377b24cd6eefc183a800c5807f759f7f9796d</span><br><span class="line">Signer #<span class="number">1</span> <span class="keyword">public</span> key SHA<span class="number">-1</span> digest: dba8196f6f49a1d1291e4c03102bc7225b6f1f25</span><br><span class="line">Signer #<span class="number">1</span> <span class="keyword">public</span> key MD5 digest: d246e0ae52179dfe9daca889ee3133ef</span><br></pre></td></tr></table></figure>

<p>看到<code>Signer #1 certificate MD5 digest: f8c49056e4ccf9a11e090eaf471f418d</code>就能得到</p>
<p>so程序的enc程序在调试的时候，老是出现错误，因此就在此留下一个小坑吧，等我变强之后再回来搞定😎</p>
<h1 id="android逆向之动态调试"><a href="#android逆向之动态调试" class="headerlink" title="android逆向之动态调试"></a>android逆向之动态调试</h1><h2 id="java层调试"><a href="#java层调试" class="headerlink" title="java层调试"></a>java层调试</h2><p>工具：android studio、apktools、smalidea、已经root的手机</p>
<p>首先apktools反编译apk为output</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d app.apk -o output</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">adb shell #adb进入命令行模式</span><br><span class="line">su #切换至超级用户</span><br><span class="line">magisk resetprop ro.debuggable 1</span><br><span class="line">stop</span><br><span class="line">start #一定要通过该方式重启</span><br></pre></td></tr></table></figure>

<p>设置手机的ro.debuggable为1，这样任何程序都可以在我们的手机上进行调试（但是缺点就是每次重启都会失效，因此在启动之后都要设置一次</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell ps</span><br></pre></td></tr></table></figure>

<p>找到对应的调试进程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u0_a137       9261  7805 1120068  56804 SyS_epoll_wait      0 S com.a.sample.picturelock</span><br></pre></td></tr></table></figure>

<p>PID为9261</p>
<p>因此设置</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Lenovo&gt; adb forward tcp:<span class="number">8700</span> jdwp:<span class="number">9261</span></span><br><span class="line"><span class="number">8700</span></span><br></pre></td></tr></table></figure>

<p>这个8700是android studio中设置的</p>
<p>来到android studio中</p>
<img src="https://cdn.jsdelivr.net/gh/s1nec-1o/photo@main/img/202504141456734.png" alt="image-20250414101310778" style="zoom: 33%;" />

<p>设置如上的部分，output是apktool反编译apk为smali的文件，其中output中的smali文件夹要将其Mark为Sources Root权限</p>
<p>之后直接到output中进行调试即可</p>
<h2 id="原生层调试"><a href="#原生层调试" class="headerlink" title="原生层调试"></a>原生层调试</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -D -n com.a.sample.picturelock/.MainActivity</span><br></pre></td></tr></table></figure>

<p>然后在adb shell中push进去ida&#x2F;dbgsrv下对应的server，运行，自动监听 23946 port</p>
<p>然后</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:<span class="number">23946</span> tcp:<span class="number">23946</span></span><br></pre></td></tr></table></figure>

<p>将PC端的端口转发到手机上对应的服务端口</p>
<p>之后ida</p>
<p><code>Debug-&gt;attach-&gt;localhost:23946</code></p>
<p>选中对应的服务即成功attack上</p>
<p>然后android studio也attach上java层即可</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://s1nec-1o.github.io">s1nec-1o</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://s1nec-1o.github.io/2025/04/14/Android%E9%80%86%E5%90%91%E4%B9%8BWiki%E7%AF%87/">http://s1nec-1o.github.io/2025/04/14/Android%E9%80%86%E5%90%91%E4%B9%8BWiki%E7%AF%87/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://s1nec-1o.github.io" target="_blank">S1nec-1o's B1og</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/android/">android</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281614288.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/05/04/Qemu%E9%80%83%E9%80%B8%E5%88%9D%E8%AF%86/" title="Qemu逃逸初识"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Qemu逃逸初识</div></div></a></div><div class="next-post pull-right"><a href="/2025/04/06/%E4%B8%80%E4%BA%9BIoT%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="一些IoT漏洞复现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">一些IoT漏洞复现</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2025/03/28/android%E4%B9%8Bhook%E5%85%A5%E9%97%A8/" title="android之hook入门"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-28</div><div class="title">android之hook入门</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281614288.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">s1nec-1o</div><div class="author-info__description">万事胜意</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="http://github.com/s1nec-1o"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">正在学习iot pwn 欢迎广大师傅与我交流</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90java%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">静态分析java层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2014-ASIS-Cyber-Security-Contest-Finals-Numdroid"><span class="toc-number">1.1.</span> <span class="toc-text">2014 ASIS Cyber Security Contest Finals Numdroid</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-number">1.1.1.</span> <span class="toc-text">逆向分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%A1%881%EF%BC%9A"><span class="toc-number">1.1.2.</span> <span class="toc-text">方案1：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%A1%882%EF%BC%9A"><span class="toc-number">1.1.3.</span> <span class="toc-text">方案2：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2014-Sharif-University-Quals-CTF-Commercial-Application"><span class="toc-number">1.2.</span> <span class="toc-text">2014 Sharif University Quals CTF Commercial Application</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2015-0CTF-vezel"><span class="toc-number">1.3.</span> <span class="toc-text">2015-0CTF-vezel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2017-XMAN-HelloSmali2"><span class="toc-number">1.4.</span> <span class="toc-text">2017 XMAN HelloSmali2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E5%8E%9F%E7%94%9F%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">静态分析原生层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2015-%E6%B5%B7%E5%B3%A1%E4%B8%A4%E5%B2%B8-%E4%B8%80%E4%B8%AA-APK%EF%BC%8C%E9%80%86%E5%90%91%E8%AF%95%E8%AF%95%E5%90%A7"><span class="toc-number">2.1.</span> <span class="toc-text">2015 - 海峡两岸 - 一个 APK，逆向试试吧</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E7%BB%BC%E5%90%88%E9%A2%98%E7%9B%AE"><span class="toc-number">3.</span> <span class="toc-text">静态分析综合题目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2017-ISCC-Crackone"><span class="toc-number">3.1.</span> <span class="toc-text">2017 ISCC Crackone</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2018-%E5%BC%BA%E7%BD%91%E6%9D%AF-picture-lock"><span class="toc-number">3.2.</span> <span class="toc-text">2018 强网杯 picture lock</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#android%E9%80%86%E5%90%91%E4%B9%8B%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95"><span class="toc-number">4.</span> <span class="toc-text">android逆向之动态调试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#java%E5%B1%82%E8%B0%83%E8%AF%95"><span class="toc-number">4.1.</span> <span class="toc-text">java层调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F%E5%B1%82%E8%B0%83%E8%AF%95"><span class="toc-number">4.2.</span> <span class="toc-text">原生层调试</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/13/protobuf%E5%88%9D%E6%8E%A2/" title="protobuf初探">protobuf初探</a><time datetime="2025-05-13T12:35:17.000Z" title="发表于 2025-05-13 20:35:17">2025-05-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/10/windows-heap%E5%88%9D%E6%8E%A2-2/" title="windows heap初探(2)">windows heap初探(2)</a><time datetime="2025-05-10T07:18:42.000Z" title="发表于 2025-05-10 15:18:42">2025-05-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/08/windows-pwn%E5%88%9D%E6%8E%A2-1/" title="windows pwn初探(1)">windows pwn初探(1)</a><time datetime="2025-05-08T06:27:53.000Z" title="发表于 2025-05-08 14:27:53">2025-05-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/04/Qemu%E9%80%83%E9%80%B8%E5%88%9D%E8%AF%86/" title="Qemu逃逸初识">Qemu逃逸初识</a><time datetime="2025-05-04T06:09:27.000Z" title="发表于 2025-05-04 14:09:27">2025-05-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/14/Android%E9%80%86%E5%90%91%E4%B9%8BWiki%E7%AF%87/" title="Android逆向之Wiki篇">Android逆向之Wiki篇</a><time datetime="2025-04-14T06:44:43.000Z" title="发表于 2025-04-14 14:44:43">2025-04-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281616326.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By s1nec-1o</div><div class="footer_custom_text">介是s1nec-1o的博客</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><div><canvas id="snow" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:99999;pointer-events:none"></canvas></div><script>const notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));</script><script async type="text/javascript" src="https://cdn.jsdelivr.net/gh/Candinya/Kratos-Rebirth@latest/source/js/snow.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>