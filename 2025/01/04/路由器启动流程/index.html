<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>openwrt路由器启动流程 | S1nec-1o's B1og</title><meta name="author" content="s1nec-1o"><meta name="copyright" content="s1nec-1o"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="openwrt路由器启动流程前言只做了大致流程的分析 总结通过&#x2F;etc&#x2F;rc.d下的链接执行**&#x2F;etc&#x2F;init.d**下的初始化服务，不过有的固件并没有init.d目录，因此还是得特殊情况特殊看待 流程&#x2F;sbin&#x2F;init-&gt;第一次&#x2F;sbin&#x2F;procd-&gt;&#x2F;sbin&#x2F;preinit">
<meta property="og:type" content="article">
<meta property="og:title" content="openwrt路由器启动流程">
<meta property="og:url" content="http://s1nec-1o.github.io/2025/01/04/%E8%B7%AF%E7%94%B1%E5%99%A8%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/index.html">
<meta property="og:site_name" content="S1nec-1o&#39;s B1og">
<meta property="og:description" content="openwrt路由器启动流程前言只做了大致流程的分析 总结通过&#x2F;etc&#x2F;rc.d下的链接执行**&#x2F;etc&#x2F;init.d**下的初始化服务，不过有的固件并没有init.d目录，因此还是得特殊情况特殊看待 流程&#x2F;sbin&#x2F;init-&gt;第一次&#x2F;sbin&#x2F;procd-&gt;&#x2F;sbin&#x2F;preinit">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281614288.png">
<meta property="article:published_time" content="2025-01-04T05:20:30.000Z">
<meta property="article:modified_time" content="2025-01-04T05:49:33.928Z">
<meta property="article:author" content="s1nec-1o">
<meta property="article:tag" content="openwrt">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281614288.png"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281712481.jpg"><link rel="canonical" href="http://s1nec-1o.github.io/2025/01/04/%E8%B7%AF%E7%94%B1%E5%99%A8%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"距离文章发布已经过去","messageNext":"天了，信息可能已经过时"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'openwrt路由器启动流程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-01-04 13:49:33'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 8 || hour >= 20
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="S1nec-1o's B1og" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281614288.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281616326.png')"><nav id="nav"><span id="blog-info"><a href="/" title="S1nec-1o's B1og"><span class="site-name">S1nec-1o's B1og</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">openwrt路由器启动流程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-01-04T05:20:30.000Z" title="发表于 2025-01-04 13:20:30">2025-01-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-04T05:49:33.928Z" title="更新于 2025-01-04 13:49:33">2025-01-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/IOT%E5%AE%89%E5%85%A8/">IOT安全</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="openwrt路由器启动流程"><a href="#openwrt路由器启动流程" class="headerlink" title="openwrt路由器启动流程"></a>openwrt路由器启动流程</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>只做了大致流程的分析</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过&#x2F;etc&#x2F;rc.d下的链接执行**&#x2F;etc&#x2F;init.d**下的初始化服务，不过有的固件并没有init.d目录，因此还是得特殊情况特殊看待</p>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><p><strong>&#x2F;sbin&#x2F;init-&gt;第一次&#x2F;sbin&#x2F;procd-&gt;&#x2F;sbin&#x2F;preinit-&gt;第二次&#x2F;sbin&#x2F;procd</strong></p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><h2 id="sbin-init"><a href="#sbin-init" class="headerlink" title="&#x2F;sbin&#x2F;init"></a>&#x2F;sbin&#x2F;init</h2><p>首先第一个启动的程序便是&#x2F;sbin&#x2F;init初始化程序</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">sigaction</span>(<span class="number">15</span>, &amp;asc_1244C, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">sigaction</span>(<span class="number">10</span>, &amp;asc_1244C, <span class="number">0</span>);</span><br><span class="line">  v3 = <span class="built_in">sigaction</span>(<span class="number">12</span>, &amp;asc_1244C, <span class="number">0</span>);</span><br><span class="line">  v4 = <span class="built_in">sub_9110</span>(v3);</span><br><span class="line">  <span class="built_in">sub_903C</span>(v4);</span><br><span class="line">  v5 = <span class="built_in">sub_9C04</span>(<span class="number">1</span>);</span><br><span class="line">  v6 = <span class="built_in">uloop_init</span>(v5);</span><br><span class="line">  v7 = <span class="built_in">sub_94D0</span>(v6);</span><br><span class="line">  <span class="built_in">uloop_run</span>(v7);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="sub-9110"><a href="#sub-9110" class="headerlink" title="sub_9110"></a>sub_9110</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_9110</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">stat</span> v2; <span class="comment">// [sp+8h] [bp-68h] BYREF</span></span><br><span class="line"></span><br><span class="line">  result = <span class="built_in">getpid</span>();</span><br><span class="line">  <span class="keyword">if</span> ( result == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">mount</span>(<span class="string">&quot;proc&quot;</span>, <span class="string">&quot;/proc&quot;</span>, <span class="string">&quot;proc&quot;</span>, <span class="number">0x400</span>u, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">mount</span>(<span class="string">&quot;sysfs&quot;</span>, <span class="string">&quot;/sys&quot;</span>, <span class="string">&quot;sysfs&quot;</span>, <span class="number">0x400</span>u, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">mount</span>(<span class="string">&quot;tmpfs&quot;</span>, <span class="string">&quot;/tmp&quot;</span>, <span class="string">&quot;tmpfs&quot;</span>, <span class="number">0x406</span>u, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">mkdir</span>(<span class="string">&quot;/tmp/run&quot;</span>, <span class="number">0x1FF</span>u);</span><br><span class="line">    <span class="built_in">mkdir</span>(<span class="string">&quot;/tmp/lock&quot;</span>, <span class="number">0x1FF</span>u);</span><br><span class="line">    <span class="built_in">mkdir</span>(<span class="string">&quot;/tmp/state&quot;</span>, <span class="number">0x1FF</span>u);</span><br><span class="line">    <span class="built_in">symlink</span>(<span class="string">&quot;/tmp&quot;</span>, <span class="string">&quot;/var&quot;</span>);</span><br><span class="line">    <span class="built_in">mount</span>(<span class="string">&quot;tmpfs&quot;</span>, <span class="string">&quot;/dev&quot;</span>, <span class="string">&quot;tmpfs&quot;</span>, <span class="number">0x400</span>u, <span class="string">&quot;mode=0755,size=512K&quot;</span>);</span><br><span class="line">    <span class="built_in">mkdir</span>(<span class="string">&quot;/dev/shm&quot;</span>, <span class="number">0x1ED</span>u);</span><br><span class="line">    <span class="built_in">mkdir</span>(<span class="string">&quot;/dev/pts&quot;</span>, <span class="number">0x1ED</span>u);</span><br><span class="line">    <span class="built_in">mount</span>(<span class="string">&quot;devpts&quot;</span>, <span class="string">&quot;/dev/pts&quot;</span>, <span class="string">&quot;devpts&quot;</span>, <span class="number">0x400</span>u, <span class="string">&quot;mode=600&quot;</span>);</span><br><span class="line">    <span class="built_in">sub_98F0</span>(<span class="string">&quot;*&quot;</span>, <span class="number">384</span>);</span><br><span class="line">    <span class="built_in">mknod</span>(<span class="string">&quot;/dev/null&quot;</span>, <span class="number">0x1B6</span>u, <span class="number">0x103</span>uLL);</span><br><span class="line">    <span class="built_in">setenv</span>(<span class="string">&quot;PATH&quot;</span>, <span class="string">&quot;/bin:/sbin:/usr/bin:/usr/sbin&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">stat</span>(<span class="string">&quot;/dev/console&quot;</span>, &amp;v2) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Failed to stat %s\n&quot;</span>, <span class="string">&quot;/dev/console&quot;</span>);</span><br><span class="line">      <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: Failed to stat %s\n&quot;</span>, <span class="string">&quot;/dev/console&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v1 = <span class="built_in">open</span>(<span class="string">&quot;/dev/console&quot;</span>, <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> )</span><br><span class="line">        v1 = <span class="built_in">open</span>(<span class="string">&quot;/dev/null&quot;</span>, <span class="number">2</span>);</span><br><span class="line">      <span class="built_in">dup2</span>(v1, <span class="number">0</span>);</span><br><span class="line">      <span class="built_in">dup2</span>(v1, <span class="number">1</span>);</span><br><span class="line">      <span class="built_in">dup2</span>(v1, <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)v1 &gt; <span class="number">2</span> )</span><br><span class="line">        <span class="built_in">close</span>(v1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Console is alive\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fputs</span>(<span class="string">&quot;procd: Console is alive\n&quot;</span>, (FILE *)stderr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到要求当前程序的pid为1，在仿真时，或许可以直接把其patch掉，挂载多个文件系统，创建目录和符号链接，设置模式，大小和权限，之后调用sub_98F0函数</p>
<h4 id="sub-98F0"><a href="#sub-98F0" class="headerlink" title="sub_98F0"></a>sub_98F0</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">sub_98F0</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">size_t</span> v6; <span class="comment">// r0</span></span><br><span class="line">  _BYTE *v7; <span class="comment">// r4</span></span><br><span class="line">  _DWORD v8[<span class="number">7</span>]; <span class="comment">// [sp+4h] [bp-1Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  v8[<span class="number">0</span>] = a2;                                   <span class="comment">// 0x180</span></span><br><span class="line">  v8[<span class="number">1</span>] = a3;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">chdir</span>(<span class="string">&quot;/dev&quot;</span>) )                          <span class="comment">// 设置当前工作目录为/dev，失败返回1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  v6 = <span class="built_in">strlen</span>(a1);                              <span class="comment">// *</span></span><br><span class="line">  v7 = <span class="built_in">malloc</span>(v6 + <span class="number">2</span>);</span><br><span class="line">  *v7 = <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(v7 + <span class="number">1</span>, a1);</span><br><span class="line">  v8[<span class="number">0</span>] = v7;                                   <span class="comment">// &amp;(**)</span></span><br><span class="line">  addrxx = (<span class="type">int</span>)v8;</span><br><span class="line">  dword_144A4 = <span class="number">1</span>;</span><br><span class="line">  dword_12460 = a2;</span><br><span class="line">  <span class="built_in">sub_9688</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">sub_9688</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">chdir</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中的sub_9688函数，是为了遍历指定目录，读取符号链接，匹配特定模式，并创建相应的设备节点。</p>
<ol>
<li><strong>参数为 0：</strong><ul>
<li>路径为 <code>/sys/dev/char</code>。</li>
<li>创建字符设备节点（<code>v14 = 0x2000</code>）。</li>
</ul>
</li>
<li><strong>参数为 1：</strong><ul>
<li>路径为 <code>&quot;/sys/dev/block&quot;</code>。</li>
<li>创建块设备节点（<code>v14 = 24576</code>，即 <code>0x6000</code>）。</li>
</ul>
</li>
</ol>
<h3 id="sub-903C"><a href="#sub-903C" class="headerlink" title="sub_903C"></a>sub_903C</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">sub_903C</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// r5</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">1016</span>]; <span class="comment">// [sp+8h] [bp-440h] BYREF</span></span><br><span class="line">  <span class="type">regex_t</span> v3; <span class="comment">// [sp+408h] [bp-40h] BYREF</span></span><br><span class="line">  <span class="type">regmatch_t</span> v4; <span class="comment">// [sp+428h] [bp-20h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [sp+430h] [bp-18h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [sp+434h] [bp-14h]</span></span><br><span class="line"></span><br><span class="line">  v0 = <span class="built_in">open</span>(<span class="string">&quot;/proc/cmdline&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  v1 = v0;</span><br><span class="line">  <span class="keyword">if</span> ( v0 &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    buf[<span class="built_in">read</span>(v0, buf, <span class="number">0x3FF</span>u)] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">close</span>(v1);</span><br><span class="line">    <span class="built_in">regcomp</span>(&amp;v3, <span class="string">&quot;init_debug=([0-9]+)&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">regexec</span>(&amp;v3, buf, <span class="number">2u</span>, &amp;v4, <span class="number">0</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      buf[v6] = <span class="number">0</span>;</span><br><span class="line">      dword_12474 = <span class="built_in">atoi</span>(&amp;buf[v5]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">regfree</span>(&amp;v3);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此函数的作用是解析内核命令行参数，提取 <code>init_debug</code> 的值，并将其存储在全局变量 <code>dword_12474</code> 中</p>
<h3 id="sub-9C04"><a href="#sub-9C04" class="headerlink" title="sub_9C04"></a>sub_9C04</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> <span class="type">char</span> *__fastcall <span class="title">sub_9C04</span><span class="params">(<span class="type">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *result; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v3; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r0</span></span><br><span class="line">  FILE *v7; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  result = <span class="built_in">getenv</span>(<span class="string">&quot;WDTFD&quot;</span>);</span><br><span class="line">  v3 = result;</span><br><span class="line">  <span class="keyword">if</span> ( dword_12464 &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    dword_144B4 = (<span class="type">int</span>)sub_9980;</span><br><span class="line">    <span class="keyword">if</span> ( result )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)dword_12474 &gt; <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Watchdog handover: fd=%s\n&quot;</span>, result);</span><br><span class="line">        <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: %s(%d): Watchdog handover: fd=%s\n&quot;</span>, <span class="string">&quot;watchdog_init&quot;</span>, <span class="number">103</span>, v3);</span><br><span class="line">      &#125;</span><br><span class="line">      dword_12464 = <span class="built_in">atoi</span>(v3);</span><br><span class="line">      result = (<span class="type">const</span> <span class="type">char</span> *)<span class="built_in">unsetenv</span>(<span class="string">&quot;WDTFD&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      dword_12464 = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v4 = dword_12464;</span><br><span class="line">    <span class="keyword">if</span> ( dword_12464 &gt;= <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !a1 )</span><br><span class="line">      &#123;</span><br><span class="line">        v5 = <span class="built_in">fcntl</span>(dword_12464, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">fcntl</span>(v4, <span class="number">2</span>, v5 | <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;- watchdog -\n&quot;</span>);</span><br><span class="line">      <span class="built_in">fputs</span>(<span class="string">&quot;procd: - watchdog -\n&quot;</span>, (FILE *)stderr);</span><br><span class="line">      <span class="built_in">sub_9A84</span>(<span class="number">30</span>);</span><br><span class="line">      result = (<span class="type">const</span> <span class="type">char</span> *)<span class="built_in">sub_9980</span>(&amp;unk_144A8);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)dword_12474 &gt; <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v6 = <span class="built_in">sub_9A84</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Opened watchdog with timeout %ds\n&quot;</span>, v6);</span><br><span class="line">        v7 = (FILE *)stderr;</span><br><span class="line">        v8 = <span class="built_in">sub_9A84</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">const</span> <span class="type">char</span> *)<span class="built_in">fprintf</span>(v7, <span class="string">&quot;procd: %s(%d): Opened watchdog with timeout %ds\n&quot;</span>, <span class="string">&quot;watchdog_init&quot;</span>, <span class="number">120</span>, v8);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>初始化看门狗计时器</p>
<h3 id="sub-94D0"><a href="#sub-94D0" class="headerlink" title="sub_94D0"></a>sub_94D0</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_94D0</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">__pid_t</span> v0; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v1; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v2; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">__pid_t</span> v3; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">char</span> *file[<span class="number">4</span>]; <span class="comment">// [sp+Ch] [bp-3Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> *v6[<span class="number">11</span>]; <span class="comment">// [sp+1Ch] [bp-2Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  v6[<span class="number">0</span>] = <span class="string">&quot;/bin/sh&quot;</span>;</span><br><span class="line">  v6[<span class="number">1</span>] = <span class="string">&quot;/etc/preinit&quot;</span>;</span><br><span class="line">  v6[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">  file[<span class="number">0</span>] = <span class="string">&quot;/sbin/procd&quot;</span>;</span><br><span class="line">  file[<span class="number">1</span>] = <span class="string">&quot;-h&quot;</span>;</span><br><span class="line">  file[<span class="number">2</span>] = <span class="string">&quot;/etc/hotplug-preinit.json&quot;</span>;</span><br><span class="line">  file[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;- preinit -\n&quot;</span>);</span><br><span class="line">  <span class="built_in">fputs</span>(<span class="string">&quot;procd: - preinit -\n&quot;</span>, (FILE *)stderr);</span><br><span class="line">  dword_12484 = (<span class="type">int</span>)sub_9344;</span><br><span class="line">  v0 = fork();</span><br><span class="line">  dword_12488 = v0;</span><br><span class="line">  <span class="keyword">if</span> ( !v0 )                                    <span class="comment">// 子</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">execvp</span>(file[<span class="number">0</span>], file);</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Failed to start plugd\n&quot;</span>);</span><br><span class="line">    v1 = &amp;byte_9F8F;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v0 &lt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Failed to start new plugd instance\n&quot;</span>);</span><br><span class="line">    v2 = byte_9FAD;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fputs</span>(v2, (FILE *)stderr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">uloop_process_add</span>(&amp;unk_12478);</span><br><span class="line">  <span class="built_in">setenv</span>(<span class="string">&quot;PREINIT&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">  dword_12498 = (<span class="type">int</span>)sub_9350;</span><br><span class="line">  v3 = fork();</span><br><span class="line">  dword_1249C = v3;</span><br><span class="line">  <span class="keyword">if</span> ( !v3 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">execvp</span>(v6[<span class="number">0</span>], v6);</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Failed to start preinit\n&quot;</span>);</span><br><span class="line">    v1 = <span class="string">&quot;procd: Failed to start preinit\n&quot;</span>;</span><br><span class="line">LABEL_8:</span><br><span class="line">    <span class="built_in">fputs</span>(v1, (FILE *)stderr);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Failed to start new preinit instance\n&quot;</span>);</span><br><span class="line">    v2 = <span class="string">&quot;procd: Failed to start new preinit instance\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fputs</span>(v2, (FILE *)stderr);</span><br><span class="line">  &#125;</span><br><span class="line">  result = <span class="built_in">uloop_process_add</span>(&amp;unk_1248C);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)dword_12474 &gt; <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Launched preinit instance, pid=%d\n&quot;</span>, dword_1249C);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: %s(%d): Launched preinit instance, pid=%d\n&quot;</span>, <span class="string">&quot;preinit&quot;</span>, <span class="number">120</span>, dword_1249C);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先fork运行&#x2F;sbin&#x2F;procd，以-h &#x2F;etc&#x2F;hotplug-preinit.json作为参数，之后uloop_process_add(&amp;unk_12478);， setenv(“PREINIT”, “1”, 1);设置preinit为1作为flag，之后fork运行&#x2F;bin&#x2F;sh，以&#x2F;etc&#x2F;preinit作为参数</p>
<blockquote>
<p><code>execvp</code> 会加载新的程序到当前进程的地址空间，覆盖原有的代码、数据和堆栈，因此紧跟execvp后面的便是错误的输出</p>
</blockquote>
<blockquote>
<p>uloop_process 是 Libubox 提供的一个进程管理工具,它并不会帮你创建进程，它主要用来等待子进程工作的结束，然后调用自定义的回调函数，所以一般需要配合 <code>fork</code>一起使用。</p>
</blockquote>
<p>这里注意观察两个地方</p>
<p>uloop_process_add(&amp;dword_12478);和result &#x3D; uloop_process_add(&amp;dword_1248C);，其实这个add的是结构体</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">uloop_process</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">list_head</span> list;</span><br><span class="line">	<span class="type">bool</span> pending;</span><br><span class="line">	uloop_process_handler cb;</span><br><span class="line">	<span class="type">pid_t</span> pid;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>实际调用的函数是cb，而list_head一般包括pre和next两个指针占用8个字节，pending由于对齐占用4个字节</p>
<p>因此之后main函数运行uloop_run(v1);这个时，调用的分别是sub_9344和sub_9350函数，但是首先来看之后运行的&#x2F;sbin&#x2F;procd和&#x2F;etc&#x2F;preinit</p>
<h3 id="sbin-procd"><a href="#sbin-procd" class="headerlink" title="&#x2F;sbin&#x2F;procd"></a>&#x2F;sbin&#x2F;procd</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> *v5; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v7; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="built_in">getenv</span>(<span class="string">&quot;DBGLVL&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v5 )</span><br><span class="line">  &#123;</span><br><span class="line">    dword_1CEE4 = <span class="built_in">atoi</span>(v5);</span><br><span class="line">    <span class="built_in">unsetenv</span>(<span class="string">&quot;DBGLVL&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = <span class="built_in">getopt</span>(argc, (<span class="type">char</span> *<span class="type">const</span> *)argv, <span class="string">&quot;d:s:h:&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v8 == <span class="number">-1</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">switch</span> ( v8 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sub_10E20</span>(optarg);</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">        dword_1AD68 = optarg;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">.......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为是-h参数，因此看前面即可，DBGLVL估计是测试debug用的</p>
<h4 id="sub-10E20"><a href="#sub-10E20" class="headerlink" title="sub_10E20"></a>sub_10E20</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">sub_10E20</span><span class="params">(<span class="type">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">uloop_init</span>();</span><br><span class="line">  v2 = <span class="built_in">sub_10C5C</span>((<span class="type">const</span> <span class="type">char</span> *)a1);</span><br><span class="line">  <span class="built_in">uloop_run</span>(v2);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_10C5C函数功能如下</p>
<ol>
<li><strong>设置热插拔套接字：</strong>（类似usb等）<ul>
<li>创建并绑定一个套接字，用于处理热插拔事件。</li>
</ul>
</li>
<li><strong>错误处理：</strong><ul>
<li>如果套接字创建或绑定失败，记录错误信息并退出程序。</li>
</ul>
</li>
<li><strong>配置套接字选项：</strong><ul>
<li>设置接收缓冲区的大小。</li>
</ul>
</li>
<li><strong>初始化 JSON 脚本：</strong><ul>
<li>调用初始化函数，准备处理 JSON 脚本。</li>
</ul>
</li>
<li><strong>添加到事件循环：</strong><ul>
<li>将套接字添加到事件循环中，以便异步处理事件。</li>
</ul>
</li>
</ol>
<h3 id="etc-preinit"><a href="#etc-preinit" class="headerlink" title="&#x2F;etc&#x2F;preinit"></a>&#x2F;etc&#x2F;preinit</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2006 OpenWrt.org</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2010 Vertical Communications</span></span><br><span class="line"></span><br><span class="line">[ -z &quot;$PREINIT&quot; ] &amp;&amp; exec /sbin/init</span><br><span class="line"></span><br><span class="line">export PATH=/bin:/sbin:/usr/bin:/usr/sbin</span><br><span class="line"></span><br><span class="line">pi_ifname=</span><br><span class="line">pi_ip=192.168.1.1</span><br><span class="line">pi_broadcast=192.168.1.255</span><br><span class="line">pi_netmask=255.255.255.0</span><br><span class="line"></span><br><span class="line">fs_failsafe_ifname=</span><br><span class="line">fs_failsafe_ip=192.168.1.1</span><br><span class="line">fs_failsafe_broadcast=192.168.1.255</span><br><span class="line">fs_failsafe_netmask=255.255.255.0</span><br><span class="line"></span><br><span class="line">fs_failsafe_wait_timeout=2</span><br><span class="line"></span><br><span class="line">pi_suppress_stderr=&quot;y&quot;</span><br><span class="line">pi_init_suppress_stderr=&quot;y&quot;</span><br><span class="line">pi_init_path=&quot;/bin:/sbin:/usr/bin:/usr/sbin&quot;</span><br><span class="line">pi_init_cmd=&quot;/sbin/init&quot;</span><br><span class="line"></span><br><span class="line">. /lib/functions.sh</span><br><span class="line">. /lib/functions/preinit.sh</span><br><span class="line">. /lib/functions/system.sh</span><br><span class="line">. /lib/functions/userconfig.sh</span><br><span class="line"></span><br><span class="line">boot_hook_init preinit_essential</span><br><span class="line">boot_hook_init preinit_main</span><br><span class="line">boot_hook_init failsafe</span><br><span class="line">boot_hook_init initramfs</span><br><span class="line">boot_hook_init preinit_mount_root</span><br><span class="line"></span><br><span class="line">for pi_source_file in /lib/preinit/*; do</span><br><span class="line">	. $pi_source_file</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">boot_run_hook preinit_essential</span><br><span class="line"></span><br><span class="line">pi_mount_skip_next=false</span><br><span class="line">pi_jffs2_mount_success=false</span><br><span class="line">pi_failsafe_net_message=false</span><br><span class="line"></span><br><span class="line">boot_run_hook preinit_main</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">. /lib/functions.sh</span><br><span class="line">. /lib/functions/preinit.sh</span><br><span class="line">. /lib/functions/system.sh</span><br><span class="line">. /lib/functions/userconfig.sh</span><br></pre></td></tr></table></figure>

<p>function.sh定义了一系列配置函数，</p>
<p>&#x2F;lib&#x2F;functions&#x2F;preinit.sh中定义了boot_hook_init函数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">boot_hook_init() &#123;</span><br><span class="line">	local hook=&quot;$&#123;1&#125;_hook&quot;</span><br><span class="line">	export -n &quot;PI_STACK_LIST=$&#123;PI_STACK_LIST:+$PI_STACK_LIST &#125;$hook&quot;</span><br><span class="line">	export -n &quot;$hook=&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类似于boot_hook_init preinit_essential，便有preinit_essential_hook&#x3D; 之类的环境变量</p>
<p>之后初始化一系列的hook，然后调用&#x2F;lib&#x2F;preinit下的函数</p>
<p>调用了如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">define_default_set_state() &#123;</span><br><span class="line">	. /etc/diag.sh</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boot_hook_add preinit_main define_default_set_state</span><br><span class="line">===============================================================================================</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Copyright (c) 2013 The Linux Foundation. All rights reserved.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="function"><span class="title">do_ipq806x</span></span>() &#123;</span></span><br><span class="line">	. /lib/ipq806x.sh</span><br><span class="line"></span><br><span class="line">	ipq806x_board_detect</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boot_hook_add preinit_main do_ipq806x</span><br><span class="line">===============================================================================================</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2006 OpenWrt.org</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2010 Vertical Communications</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">commands <span class="keyword">for</span> emitting messages to network <span class="keyword">in</span> failsafe mode</span></span><br><span class="line"></span><br><span class="line">indicate_failsafe_led () &#123;</span><br><span class="line">	set_state failsafe</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">indicate_failsafe() &#123;</span><br><span class="line">	echo &quot;- failsafe -&quot;</span><br><span class="line">	preinit_net_echo &quot;Entering Failsafe!\n&quot;</span><br><span class="line">	indicate_failsafe_led</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boot_hook_add failsafe indicate_failsafe</span><br><span class="line">===============================================================================================</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2006 OpenWrt.org</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2010 Vertical Communications</span></span><br><span class="line"></span><br><span class="line">preinit_ip() &#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="keyword">if</span> the preinit interface isn<span class="string">&#x27;t specified and ifname is set in</span></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">preinit.arch use that interface</span></span></span><br><span class="line">	if [ -z &quot;$pi_ifname&quot; ]; then</span><br><span class="line">		pi_ifname=$ifname</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	[ -n &quot;$pi_ifname&quot; ] &amp;&amp; grep -q &quot;$pi_ifname&quot; /proc/net/dev &amp;&amp; &#123;</span><br><span class="line">		ifconfig $pi_ifname $pi_ip netmask $pi_netmask broadcast $pi_broadcast up</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">preinit_ip_deconfig() &#123;</span><br><span class="line">	[ -n &quot;$pi_ifname&quot; ] &amp;&amp; grep -q &quot;$pi_ifname&quot; /proc/net/dev &amp;&amp; &#123;</span><br><span class="line">		ifconfig $pi_ifname 0.0.0.0 down</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">preinit_net_echo() &#123;</span><br><span class="line">	[ -n &quot;$pi_ifname&quot; ] &amp;&amp; grep -q &quot;$pi_ifname&quot; /proc/net/dev &amp;&amp; &#123;</span><br><span class="line">		&#123;</span><br><span class="line">			[ &quot;$pi_preinit_net_messages&quot; = &quot;y&quot; ] || &#123;</span><br><span class="line">				[ &quot;$pi_failsafe_net_message&quot; = &quot;true&quot; ] &amp;&amp;</span><br><span class="line">					[ &quot;$pi_preinit_no_failsafe_netmsg&quot; != &quot;y&quot; ]</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; &amp;&amp; netmsg $pi_broadcast &quot;$1&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">preinit_echo() &#123;</span><br><span class="line">	preinit_net_echo $1</span><br><span class="line">	echo $1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pi_indicate_led() &#123;</span><br><span class="line">	set_state preinit</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pi_indicate_preinit() &#123;</span><br><span class="line">	preinit_net_echo &quot;Doing OpenWRT Preinit\n&quot;</span><br><span class="line">	pi_indicate_led</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boot_hook_add preinit_main preinit_ip</span><br><span class="line">boot_hook_add preinit_main pi_indicate_preinit</span><br><span class="line">===============================================================================================</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">!/bin/sh</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Copyright (C) 2006-2010 OpenWrt.org</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Copyright (C) 2010 Vertical Communications</span></span></span><br><span class="line"></span><br><span class="line">fs_wait_for_key () &#123;</span><br><span class="line">	local timeout=$3</span><br><span class="line">	local timer</span><br><span class="line">	local do_keypress</span><br><span class="line">	local keypress_true=&quot;$(mktemp)&quot;</span><br><span class="line">	local keypress_wait=&quot;$(mktemp)&quot;</span><br><span class="line">	local keypress_sec=&quot;$(mktemp)&quot;</span><br><span class="line">	if [ -z &quot;$keypress_wait&quot; ]; then</span><br><span class="line">		keypress_wait=/tmp/.keypress_wait</span><br><span class="line">		touch $keypress_wait</span><br><span class="line">	fi</span><br><span class="line">	if [ -z &quot;$keypress_true&quot; ]; then</span><br><span class="line">		keypress_true=/tmp/.keypress_true</span><br><span class="line">		touch $keypress_true</span><br><span class="line">	fi</span><br><span class="line">	if [ -z &quot;$keypress_sec&quot; ]; then</span><br><span class="line">		keypress_sec=/tmp/.keypress_sec</span><br><span class="line">		touch $keypress_sec</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	trap &quot;echo &#x27;true&#x27; &gt;$keypress_true; lock -u $keypress_wait ; rm -f $keypress_wait&quot; INT</span><br><span class="line">	trap &quot;echo &#x27;true&#x27; &gt;$keypress_true; lock -u $keypress_wait ; rm -f $keypress_wait&quot; USR1</span><br><span class="line"></span><br><span class="line">	[ -n &quot;$timeout&quot; ] || timeout=1</span><br><span class="line">	[ $timeout -ge 1 ] || timeout=1</span><br><span class="line">	timer=$timeout</span><br><span class="line">	lock $keypress_wait</span><br><span class="line">	&#123;</span><br><span class="line">		while [ $timer -gt 0 ]; do</span><br><span class="line">			echo &quot;$timer&quot; &gt;$keypress_sec</span><br><span class="line">			timer=$(($timer - 1))</span><br><span class="line">			sleep 1</span><br><span class="line">		done</span><br><span class="line">		lock -u $keypress_wait</span><br><span class="line">		rm -f $keypress_wait</span><br><span class="line">	&#125; &amp;</span><br><span class="line"></span><br><span class="line">	echo &quot;Press the [$1] key and hit [enter] $2&quot;</span><br><span class="line">	echo &quot;Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash"><span class="string">if we&#x27;</span>re on the console we <span class="built_in">wait</span> <span class="keyword">for</span> input</span></span><br><span class="line">	&#123;</span><br><span class="line">		while [ -r $keypress_wait ]; do</span><br><span class="line">			timer=&quot;$(cat $keypress_sec)&quot;</span><br><span class="line"></span><br><span class="line">			[ -n &quot;$timer&quot; ] || timer=1</span><br><span class="line">			timer=&quot;$&#123;timer%%\ *&#125;&quot;</span><br><span class="line">			[ $timer -ge 1 ] || timer=1</span><br><span class="line">			do_keypress=&quot;&quot;</span><br><span class="line">			&#123;</span><br><span class="line">				read -t &quot;$timer&quot; do_keypress</span><br><span class="line">				case &quot;$do_keypress&quot; in</span><br><span class="line">				$1)</span><br><span class="line">					echo &quot;true&quot; &gt;$keypress_true</span><br><span class="line">					;;</span><br><span class="line">				1 | 2 | 3 | 4)</span><br><span class="line">					echo &quot;$do_keypress&quot; &gt;/tmp/debug_level</span><br><span class="line">					;;</span><br><span class="line">				*)</span><br><span class="line">					continue;</span><br><span class="line">					;;</span><br><span class="line">				esac</span><br><span class="line">				lock -u $keypress_wait</span><br><span class="line">				rm -f $keypress_wait</span><br><span class="line">			&#125;</span><br><span class="line">		done</span><br><span class="line">	&#125;</span><br><span class="line">	lock -w $keypress_wait</span><br><span class="line"></span><br><span class="line">	keypressed=1</span><br><span class="line">	[ &quot;$(cat $keypress_true)&quot; = &quot;true&quot; ] &amp;&amp; keypressed=0</span><br><span class="line"></span><br><span class="line">	rm -f $keypress_true</span><br><span class="line">	rm -f $keypress_wait</span><br><span class="line">	rm -f $keypress_sec</span><br><span class="line"></span><br><span class="line">	return $keypressed</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">failsafe_wait() &#123;</span><br><span class="line">        local is_failsafe=$(uci get system.@system[0].failsafe)</span><br><span class="line">        echo &quot;is_failsafe is $is_failsafe&quot; &gt; /dev/console</span><br><span class="line">        if [ $is_failsafe = &quot;true&quot; ]; then </span><br><span class="line">                FAILSAFE=</span><br><span class="line">	        grep -q &#x27;failsafe=&#x27; /proc/cmdline &amp;&amp; FAILSAFE=true &amp;&amp; export FAILSAFE</span><br><span class="line">        	if [ &quot;$FAILSAFE&quot; != &quot;true&quot; ]; then</span><br><span class="line">                	pi_failsafe_net_message=true</span><br><span class="line">                	preinit_net_echo &quot;Please press button now to enter failsafe&quot;</span><br><span class="line">                	pi_failsafe_net_message=false</span><br><span class="line">                	fs_wait_for_key f &#x27;to enter failsafe mode&#x27; $fs_failsafe_wait_timeout &amp;&amp; FAILSAFE=true</span><br><span class="line">               	        [ -f &quot;/tmp/failsafe_button&quot; ] &amp;&amp; FAILSAFE=true &amp;&amp; echo &quot;- failsafe button &quot;`cat /tmp/failsafe_button`&quot; was pressed -&quot;</span><br><span class="line">                	[ &quot;$FAILSAFE&quot; = &quot;true&quot; ] &amp;&amp; export FAILSAFE &amp;&amp; touch /tmp/failsafe</span><br><span class="line">        	fi</span><br><span class="line"></span><br><span class="line">        fi </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boot_hook_add preinit_main failsafe_wait</span><br><span class="line">===============================================================================================</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2006-2010 OpenWrt.org</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2010 Vertical Communications</span></span><br><span class="line"></span><br><span class="line">run_failsafe_hook() &#123;</span><br><span class="line">    if [ &quot;$FAILSAFE&quot; = &quot;true&quot; ]; then</span><br><span class="line">	boot_run_hook failsafe</span><br><span class="line">	lock -w /tmp/.failsafe</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boot_hook_add preinit_main run_failsafe_hook</span><br><span class="line">===============================================================================================</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2006 OpenWrt.org</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2010 Vertical Communications</span></span><br><span class="line"></span><br><span class="line">indicate_regular_preinit() &#123;</span><br><span class="line">	preinit_net_echo &quot;Continuing with Regular Preinit\n&quot;</span><br><span class="line">	pi_indicate_led</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boot_hook_add preinit_main indicate_regular_preinit</span><br><span class="line">===============================================================================================</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2006 OpenWrt.org</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2010 Vertical Communications</span></span><br><span class="line"></span><br><span class="line">initramfs_test() &#123;</span><br><span class="line">	if [ -n &quot;$INITRAMFS&quot; ]; then</span><br><span class="line">		boot_run_hook initramfs</span><br><span class="line">		preinit_ip_deconfig</span><br><span class="line">		break</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boot_hook_add preinit_main initramfs_test</span><br><span class="line">===============================================================================================</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2006 OpenWrt.org</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2010 Vertical Communications</span></span><br><span class="line"></span><br><span class="line">do_mount_root() &#123;</span><br><span class="line">	ramoverlay</span><br><span class="line">	find_mount_jffs2</span><br><span class="line">    rootfs_init_etc_ramfs</span><br><span class="line">	boot_run_hook preinit_mount_root</span><br><span class="line">	</span><br><span class="line">	defFlag=`grep -o Default /tmp/userconfig/userconfig_default.tmp`</span><br><span class="line">	if [ -n &quot;$defFlag&quot; ] &amp;&amp; [ $defFlag = &#x27;Default&#x27; ];</span><br><span class="line">	then</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash"><span class="built_in">set</span> dftmac from tddp flash</span></span><br><span class="line">		/usr/bin/tddpd dftmac</span><br><span class="line">		/lib/cfg_save/config.sh save</span><br><span class="line">	else</span><br><span class="line">	   echo &quot;no&quot;</span><br><span class="line">	fi</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[ &quot;$INITRAMFS&quot; = &quot;1&quot; ] || boot_hook_add preinit_main do_mount_root</span><br><span class="line">===============================================================================================</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2006 OpenWrt.org</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2010 Vertical Communications</span></span><br><span class="line"></span><br><span class="line">failsafe_netlogin () &#123;</span><br><span class="line">	telnetd -l /bin/login.sh &lt;&gt; /dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">failsafe_shell() &#123;</span><br><span class="line">	lock /tmp/.failsafe</span><br><span class="line">	ash --login</span><br><span class="line">	echo &quot;Please reboot system when done with failsafe network logins&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boot_hook_add failsafe failsafe_netlogin</span><br><span class="line">boot_hook_add failsafe failsafe_shell</span><br><span class="line">===============================================================================================</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2006 OpenWrt.org</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (C) 2010 Vertical Communications</span></span><br><span class="line"></span><br><span class="line">run_init() &#123;</span><br><span class="line">	preinit_ip_deconfig</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boot_hook_add preinit_main run_init</span><br></pre></td></tr></table></figure>

<p>执行preinit_essential，而preinit_essential中啥也没有，因此什么都不执行？？</p>
<p>之后执行preinit_main，preinit_main中有<strong>define_default_set_state</strong>，<strong>do_ipq806x</strong>，<strong>preinit_ip</strong>，<strong>pi_indicate_preinit</strong>，<strong>failsafe_wait</strong>，<strong>run_failsafe_hook</strong>，<strong>indicate_regular_preinit</strong>，<strong>initramfs_test</strong>，<strong>do_mount_root</strong>，<strong>run_init</strong>函数，分别执行如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">define_default_set_state</span>() &#123;</span><br><span class="line">	. /etc/diag.sh</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行&#x2F;etc&#x2F;diag.sh，<code>set_state() &#123; :; &#125;</code>default set</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">do_ipq806x() &#123;</span><br><span class="line">	. /lib/ipq806x.sh</span><br><span class="line"></span><br><span class="line">	ipq806x_board_detect</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行ipq806x.sh脚本中的**<code>ipq806x_board_detect</code>**函数，作用：读取板子的信息并记录</p>
<p><strong><code>preinit_ip</code></strong> 函数</p>
<ul>
<li><strong>接口选择</strong>：<ul>
<li>如果 <code>pi_ifname</code> 未设置，则使用 <code>ifname</code>。</li>
</ul>
</li>
<li><strong>配置接口</strong>：<ul>
<li>检查接口是否存在于 <code>/proc/net/dev</code>。</li>
<li>使用 <code>ifconfig</code> 命令配置接口的 IP 地址、子网掩码和广播地址，并激活接口。</li>
</ul>
</li>
</ul>
<p>**<code>pi_indicate_preinit</code>**：输出并亮灯预示初始化的状态，想来启动路由器的时候的亮灯由此而来</p>
<p><strong><code>failsafe_wait</code></strong> 函数：检测系统上是否应该进入故障安全模式（在给定的超时时间内<strong>等待特定按键输入</strong>，以触发故障安全模式或设置调试级别）</p>
<p>**<code>run_failsafe_hook</code> **函数：检查系统是否进入故障安全模式，如果进入则执行failsafe，并创建一个锁lock -w &#x2F;tmp&#x2F;.failsafe</p>
<p>**<code>indicate_regular_preinit</code>**函数：输出”Continuing with Regular Preinit\n”，并再次亮灯</p>
<p>**<code>initramfs_test</code>**函数：检查系统是否在 initramfs 模式下运行，并执行相关操作</p>
<blockquote>
<p>Initramfs 模式是一种用于引导 Linux 系统的初始文件系统模式。它通常用于在内核启动时提供一个临时的根文件系统，以便加载必要的驱动程序和初始化脚本，直到真正的根文件系统可以挂载为止。（或许解加密脚本便是从这里开始的？？）</p>
</blockquote>
<p>**<code>do_mount_root</code> **函数：负责挂载根文件系统并进行相关初始化。</p>
<p>**<code>run_init</code>**函数：运行preinit_ip_deconfig，负责卸载特定网络接口的 IP 配置。（对于重置网络环境十分重要）</p>
<p>至此preinit便运行完成</p>
<p>之后便回到&#x2F;sbin&#x2F;init中执行uloop_run(v1);</p>
<h3 id="sub-9344"><a href="#sub-9344" class="headerlink" title="sub_9344"></a>sub_9344</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">sub_9344</span><span class="params">(<span class="type">int</span> result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  *(_DWORD *)(result + <span class="number">16</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或许是对下一个的赋值？？要求下一个函数必须在子进程运行完毕才可运行？（感觉有道理</p>
<h3 id="sub-9350"><a href="#sub-9350" class="headerlink" title="sub_9350"></a>sub_9350</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_9350</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v0; <span class="comment">// r4</span></span><br><span class="line">  FILE *v1; <span class="comment">// r0</span></span><br><span class="line">  FILE *v2; <span class="comment">// r4</span></span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">stat</span> v4; <span class="comment">// [sp+0h] [bp-70h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *argv[<span class="number">2</span>]; <span class="comment">// [sp+58h] [bp-18h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [sp+60h] [bp-10h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">12</span>]; <span class="comment">// [sp+64h] [bp-Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  argv[<span class="number">0</span>] = <span class="string">&quot;/sbin/procd&quot;</span>;</span><br><span class="line">  argv[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  v0 = (<span class="type">const</span> <span class="type">char</span> *)<span class="built_in">sub_9BC4</span>();</span><br><span class="line">  <span class="keyword">if</span> ( dword_12488 &gt; <span class="number">0</span> )</span><br><span class="line">    <span class="built_in">kill</span>(dword_12488, <span class="number">9</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">stat</span>(<span class="string">&quot;/tmp/sysupgrade&quot;</span>, &amp;v4) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      <span class="built_in">sleep</span>(<span class="number">1u</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">unsetenv</span>(<span class="string">&quot;INITRAMFS&quot;</span>);</span><br><span class="line">  <span class="built_in">unsetenv</span>(<span class="string">&quot;PREINIT&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)dword_12474 &gt; <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Exec to real procd now\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: %s(%d): Exec to real procd now\n&quot;</span>, <span class="string">&quot;spawn_procd&quot;</span>, <span class="number">66</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v0 )</span><br><span class="line">    <span class="built_in">setenv</span>(<span class="string">&quot;WDTFD&quot;</span>, v0, <span class="number">1</span>);</span><br><span class="line">  v1 = <span class="built_in">fopen</span>(<span class="string">&quot;/tmp/debug_level&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v2 = v1;</span><br><span class="line">  <span class="keyword">if</span> ( v1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">fscanf</span>(v1, <span class="string">&quot;%d&quot;</span>, &amp;v6);</span><br><span class="line">    <span class="built_in">fclose</span>(v2);</span><br><span class="line">    <span class="built_in">unlink</span>(<span class="string">&quot;/tmp/debug_level&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)(v6 - <span class="number">1</span>) &lt;= <span class="number">3</span> )</span><br><span class="line">      dword_12474 = v6;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( dword_12474 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">snprintf</span>(s, <span class="number">2u</span>, <span class="string">&quot;%d&quot;</span>, dword_12474);</span><br><span class="line">    <span class="built_in">setenv</span>(<span class="string">&quot;DBGLVL&quot;</span>, s, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">execvp</span>(argv[<span class="number">0</span>], argv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该函数用于清理环境、设置调试级别，并最终再次执行 <code>/sbin/procd</code></p>
<h2 id="sbin-procd-1"><a href="#sbin-procd-1" class="headerlink" title="&#x2F;sbin&#x2F;procd"></a>&#x2F;sbin&#x2F;procd</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> *v5; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v7; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="built_in">getenv</span>(<span class="string">&quot;DBGLVL&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v5 )</span><br><span class="line">  &#123;</span><br><span class="line">    debug_level = <span class="built_in">atoi</span>(v5);</span><br><span class="line">    <span class="built_in">unsetenv</span>(<span class="string">&quot;DBGLVL&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = <span class="built_in">getopt</span>(argc, (<span class="type">char</span> *<span class="type">const</span> *)argv, <span class="string">&quot;d:s:h:&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v8 == <span class="number">-1</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    ......</span><br><span class="line">  &#125;</span><br><span class="line">  v9 = <span class="built_in">uloop_init</span>();</span><br><span class="line">  v10 = <span class="built_in">sub_A798</span>(v9);</span><br><span class="line">  <span class="built_in">sub_F594</span>(v10);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">getpid</span>() == <span class="number">1</span> )</span><br><span class="line">    v11 = <span class="built_in">sub_AE4C</span>();</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v11 = <span class="built_in">sub_BD60</span>();</span><br><span class="line">  <span class="built_in">uloop_run</span>(v11);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于没有参数，便直接break了</p>
<h3 id="sub-A798"><a href="#sub-A798" class="headerlink" title="sub_A798"></a>sub_A798</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_A798</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">signal</span>(<span class="number">13</span>, (<span class="type">__sighandler_t</span>)<span class="number">1</span>);</span><br><span class="line">  result = <span class="built_in">getpid</span>();</span><br><span class="line">  <span class="keyword">if</span> ( result == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sigaction</span>(<span class="number">15</span>, &amp;act, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">sigaction</span>(<span class="number">10</span>, &amp;act, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">sigaction</span>(<span class="number">12</span>, &amp;act, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">sigaction</span>(<span class="number">11</span>, &amp;off_1AA20, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">sigaction</span>(<span class="number">7</span>, &amp;off_1AA20, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">sigaction</span>(<span class="number">1</span>, &amp;off_1AA34, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">sigaction</span>(<span class="number">9</span>, &amp;off_1AA34, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sigaction</span>(<span class="number">19</span>, &amp;off_1AA34, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置系统调用的处理方式，act是shutdown，1AA20是reboot，1AA34是无效调用</p>
<p>由于是execvp替换进程而pid是不会改变的，因此pid还是1，调用sub_AE4C函数</p>
<h3 id="sub-AE4C"><a href="#sub-AE4C" class="headerlink" title="sub_AE4C"></a>sub_AE4C</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">sub_AE4C</span><span class="params">(<span class="type">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)debug_level &gt; <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Change state %d -&gt; %d\n&quot;</span>, choi, choi + <span class="number">1</span>);</span><br><span class="line">    a1 = <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: %s(%d): Change state %d -&gt; %d\n&quot;</span>, <span class="string">&quot;procd_state_next&quot;</span>, <span class="number">90</span>, choi, choi + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ++choi;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_AC7C</span>(a1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="sub-AC7C"><a href="#sub-AC7C" class="headerlink" title="sub_AC7C"></a>sub_AC7C</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">sub_AC7C</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">28</span>]; <span class="comment">// [sp+4h] [bp-1Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(v3, <span class="string">&quot;/sbin/ubusd&quot;</span>);</span><br><span class="line">  <span class="keyword">switch</span> ( choi )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;- early -\n&quot;</span>);</span><br><span class="line">      <span class="built_in">fputs</span>(<span class="string">&quot;procd: - early -\n&quot;</span>, (FILE *)stderr);</span><br><span class="line">      <span class="built_in">sub_AACC</span>(<span class="number">0</span>);</span><br><span class="line">      v0 = <span class="built_in">sub_10C5C</span>(<span class="string">&quot;/etc/hotplug.json&quot;</span>);</span><br><span class="line">      <span class="built_in">sub_FAF8</span>(v0);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      <span class="built_in">sub_AACC</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;- ubus -\n&quot;</span>);</span><br><span class="line">      v1 = <span class="built_in">fputs</span>(<span class="string">&quot;procd: - ubus -\n&quot;</span>, (FILE *)stderr);</span><br><span class="line">      <span class="built_in">sub_BD60</span>(v1);</span><br><span class="line">      <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;- init -\n&quot;</span>);</span><br><span class="line">      v2 = <span class="built_in">fputs</span>(<span class="string">&quot;procd: - init -\n&quot;</span>, (FILE *)stderr);</span><br><span class="line">      <span class="built_in">sub_D628</span>(v2);</span><br><span class="line">      <span class="built_in">sub_D4CC</span>(<span class="string">&quot;ubus&quot;</span>, v3);</span><br><span class="line">      <span class="built_in">sub_B458</span>();</span><br><span class="line">      <span class="built_in">sub_B3F4</span>(<span class="string">&quot;respawn&quot;</span>);</span><br><span class="line">      <span class="built_in">sub_B3F4</span>(<span class="string">&quot;askconsole&quot;</span>);</span><br><span class="line">      <span class="built_in">sub_B3F4</span>(<span class="string">&quot;askfirst&quot;</span>);</span><br><span class="line">      <span class="built_in">sub_B3F4</span>(<span class="string">&quot;sysinit&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;- init complete -\n&quot;</span>);</span><br><span class="line">      <span class="built_in">fputs</span>(<span class="string">&quot;procd: - init complete -\n&quot;</span>, (FILE *)stderr);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;- shutdown -\n&quot;</span>);</span><br><span class="line">      <span class="built_in">fputs</span>(<span class="string">&quot;procd: - shutdown -\n&quot;</span>, (FILE *)stderr);</span><br><span class="line">      <span class="built_in">sub_B3F4</span>(<span class="string">&quot;shutdown&quot;</span>);</span><br><span class="line">      <span class="built_in">sync</span>();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">      <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;- reboot -\n&quot;</span>);</span><br><span class="line">      <span class="built_in">fputs</span>(<span class="string">&quot;procd: - reboot -\n&quot;</span>, (FILE *)stderr);</span><br><span class="line">      <span class="built_in">reboot</span>(dword_1ACCC);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Unhandled state %d\n&quot;</span>, choi);</span><br><span class="line">      <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: Unhandled state %d\n&quot;</span>, choi);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>状态处理</strong></p>
<ol>
<li><strong><code>case 1</code> - Early</strong>：<ul>
<li>记录日志 “- early -“</li>
<li>调用 <code>sub_AACC(0)</code> 执行早期初始化。</li>
<li>调用 <code>sub_10C5C(&quot;/etc/hotplug.json&quot;)</code> 处理配置文件。</li>
<li>调用 <code>sub_FAF8</code> 可能用于进一步初始化。</li>
</ul>
</li>
<li><strong><code>case 2</code> - Ubus Initialization</strong>：<ul>
<li>调用 <code>sub_AACC(0)</code>。</li>
<li>记录日志 “- ubus -“</li>
<li>调用 <code>sub_BD60</code> 进行 Ubus 初始化。</li>
<li>记录日志 “- init -“</li>
<li>调用 <code>sub_D628</code> 进行进一步初始化。</li>
<li>调用 <code>sub_D4CC(&quot;ubus&quot;, v3)</code> 启动 <code>/sbin/ubusd</code>。</li>
<li>调用 <code>sub_B458()</code> 执行其他初始化步骤。</li>
<li>调用 <code>sub_B3F4</code> 处理一系列状态（”respawn”, “askconsole”, “askfirst”, “sysinit”）。</li>
</ul>
</li>
<li><strong><code>case 3</code> - Init Complete</strong>：<ul>
<li>记录日志 “- init complete -“</li>
</ul>
</li>
<li><strong><code>case 4</code> - Shutdown</strong>：<ul>
<li>记录日志 “- shutdown -“</li>
<li>调用 <code>sub_B3F4(&quot;shutdown&quot;)</code> 处理关闭操作。</li>
<li>调用 <code>sync()</code> 确保数据完整性。</li>
</ul>
</li>
<li><strong><code>case 5</code> - Reboot</strong>：<ul>
<li>记录日志 “- reboot -“</li>
<li>调用 <code>reboot(dword_1ACCC)</code> 执行重启。</li>
</ul>
</li>
<li><strong><code>default</code> - Unhandled State</strong>：<ul>
<li>记录未处理状态的日志。</li>
</ul>
</li>
</ol>
<h4 id="case1"><a href="#case1" class="headerlink" title="case1"></a>case1</h4><p>sub_AACC函数确保在系统启动时正确初始化看门狗，以便在系统无响应时采取适当措施。</p>
<p>sub_10C5C函数用于设置和配置一个处理热插拔事件的套接字，并将其集成到事件循环中（或许第一次是初始化，这次才是配置？）</p>
<h4 id="sub-FAF8"><a href="#sub-FAF8" class="headerlink" title="sub_FAF8"></a>sub_FAF8</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> *<span class="title">sub_FAF8</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">__pid_t</span> v0; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">void</span> *data; <span class="comment">// [sp+0h] [bp-20h]</span></span><br><span class="line">  <span class="type">char</span> *file[<span class="number">6</span>]; <span class="comment">// [sp+8h] [bp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  file[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  file[<span class="number">0</span>] = <span class="string">&quot;udevtrigger&quot;</span>;</span><br><span class="line">  <span class="built_in">umount2</span>(<span class="string">&quot;/dev/pts&quot;</span>, <span class="number">2</span>);</span><br><span class="line">  <span class="built_in">umount2</span>(<span class="string">&quot;/dev/&quot;</span>, <span class="number">2</span>);</span><br><span class="line">  <span class="built_in">mount</span>(<span class="string">&quot;tmpfs&quot;</span>, <span class="string">&quot;/dev&quot;</span>, <span class="string">&quot;tmpfs&quot;</span>, <span class="number">0</span>, <span class="string">&quot;mode=0755,size=512K&quot;</span>);</span><br><span class="line">  <span class="built_in">mkdir</span>(<span class="string">&quot;/dev/shm&quot;</span>, <span class="number">0x1ED</span>u);</span><br><span class="line">  <span class="built_in">mkdir</span>(<span class="string">&quot;/dev/pts&quot;</span>, <span class="number">0x1ED</span>u);</span><br><span class="line">  <span class="built_in">mount</span>(<span class="string">&quot;devpts&quot;</span>, <span class="string">&quot;/dev/pts&quot;</span>, <span class="string">&quot;devpts&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  dword_1AE8C = (<span class="type">int</span>)sub_FA40;</span><br><span class="line">  v0 = fork();</span><br><span class="line">  dword_1AE90 = v0;</span><br><span class="line">  <span class="keyword">if</span> ( !v0 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">execvp</span>(file[<span class="number">0</span>], file);</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Failed to start coldplug\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fputs</span>(<span class="string">&quot;procd: Failed to start coldplug\n&quot;</span>, (FILE *)stderr);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v0 &lt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Failed to start new coldplug instance\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fputs</span>(<span class="string">&quot;procd: Failed to start new coldplug instance\n&quot;</span>, (FILE *)stderr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">uloop_process_add</span>(&amp;unk_1AE80);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)debug_level &gt; <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Launched coldplug instance, pid=%d\n&quot;</span>, dword_1AE90);</span><br><span class="line">      <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: %s(%d): Launched coldplug instance, pid=%d\n&quot;</span>, <span class="string">&quot;procd_coldplug&quot;</span>, <span class="number">65</span>, dword_1AE90);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>整个函数的主要作用便是在系统启动时检测和初始化所有已连接的硬件设备，并add一个process sub_FA40</p>
<h3 id="sub-FA40"><a href="#sub-FA40" class="headerlink" title="sub_FA40"></a>sub_FA40</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_FA40</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)debug_level &gt; <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Finished udevtrigger\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: %s(%d): Finished udevtrigger\n&quot;</span>, <span class="string">&quot;udevtrigger_complete&quot;</span>, <span class="number">36</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_10C38</span>(sub_FA9C);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大致的还是一个log的记录，主要还是</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_FA9C</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)debug_level &gt; <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Coldplug complete\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: %s(%d): Coldplug complete\n&quot;</span>, <span class="string">&quot;coldplug_complete&quot;</span>, <span class="number">29</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v0 = <span class="built_in">sub_10C38</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_AE4C</span>(v0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>又运行一次sub_AE4C函数</p>
<p>此时就是case2了</p>
<h4 id="case2"><a href="#case2" class="headerlink" title="case2"></a>case2</h4><h4 id="sub-8D60"><a href="#sub-8D60" class="headerlink" title="sub_8D60"></a>sub_8D60</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_BD60</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  dword_1AD5C = (<span class="type">int</span>)sub_BC18;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">uloop_timeout_set</span>(&amp;unk_1AD50, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_BC18</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  v0 = <span class="built_in">ubus_connect</span>(dword_1AD68);</span><br><span class="line">  dword_1AD6C = v0;</span><br><span class="line">  <span class="keyword">if</span> ( v0 )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)(v0 + <span class="number">92</span>) = sub_BBFC;</span><br><span class="line">    <span class="built_in">sub_D610</span>();</span><br><span class="line">    <span class="built_in">sub_C79C</span>(dword_1AD6C);</span><br><span class="line">    <span class="built_in">sub_F99C</span>(dword_1AD6C);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)debug_level &gt; <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Connected to ubus, id=%08x\n&quot;</span>, *(_DWORD *)(dword_1AD6C + <span class="number">80</span>));</span><br><span class="line">      <span class="built_in">fprintf</span>(</span><br><span class="line">        (FILE *)stderr,</span><br><span class="line">        <span class="string">&quot;procd: %s(%d): Connected to ubus, id=%08x\n&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ubus_connect_cb&quot;</span>,</span><br><span class="line">        <span class="number">58</span>,</span><br><span class="line">        *(_DWORD *)(dword_1AD6C + <span class="number">80</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">uloop_fd_add</span>(dword_1AD6C + <span class="number">44</span>, <span class="number">9</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)debug_level &gt; <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Connection to ubus failed\n&quot;</span>);</span><br><span class="line">      <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: %s(%d): Connection to ubus failed\n&quot;</span>, <span class="string">&quot;ubus_connect_cb&quot;</span>, <span class="number">48</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">uloop_timeout_set</span>(&amp;unk_1AD50, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>尝试连接到 <code>ubus</code>，并根据连接结果执行相应的初始化和事件处理设置。成功时，配置回调并将连接添加到事件循环；失败时，设置一个定时器以便稍后重试。</p>
<h4 id="sub-D4CC"><a href="#sub-D4CC" class="headerlink" title="sub_D4CC"></a>sub_D4CC</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">sub_D4CC</span><span class="params">(<span class="type">char</span> *a1, <span class="type">char</span> *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// r7</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r6</span></span><br><span class="line">  <span class="type">char</span> *i; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">char</span> *v8; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// r6</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">blob_buf_init</span>(&amp;dword_1AD8C, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">sub_CE04</span>((<span class="type">int</span>)<span class="string">&quot;name&quot;</span>, a1);</span><br><span class="line">  v4 = <span class="built_in">blobmsg_open_nested</span>(&amp;dword_1AD8C, <span class="string">&quot;instances&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  v5 = <span class="built_in">blobmsg_open_nested</span>(&amp;dword_1AD8C, <span class="string">&quot;instance1&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  v6 = <span class="built_in">blobmsg_open_nested</span>(&amp;dword_1AD8C, <span class="string">&quot;command&quot;</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = a2; ; i = <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = <span class="built_in">strtok</span>(i, <span class="string">&quot; &quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !v8 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">sub_CE04</span>(<span class="number">0</span>, v8);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">blob_nest_end</span>(&amp;dword_1AD8C, v6);</span><br><span class="line">  v9 = <span class="built_in">blobmsg_open_nested</span>(&amp;dword_1AD8C, <span class="string">&quot;respawn&quot;</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">sub_CE04</span>(<span class="number">0</span>, <span class="string">&quot;3600&quot;</span>);</span><br><span class="line">  <span class="built_in">sub_CE04</span>(<span class="number">0</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">  <span class="built_in">sub_CE04</span>(<span class="number">0</span>, (<span class="type">char</span> *)<span class="string">&quot;0&quot;</span>);</span><br><span class="line">  <span class="built_in">blob_nest_end</span>(&amp;dword_1AD8C, v9);</span><br><span class="line">  <span class="built_in">blob_nest_end</span>(&amp;dword_1AD8C, v5);</span><br><span class="line">  <span class="built_in">blob_nest_end</span>(&amp;dword_1AD8C, v4);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_D304</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, (<span class="type">char</span> *)<span class="string">&quot;add&quot;</span>, dword_1AD8C);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过构建 <code>blobmsg</code> 消息来组织和传递数据。它<strong>创建一个包含实例和命令的结构</strong>，适用于需要复杂数据传递的场景。最终调用 <code>sub_D304</code> 处理该消息。</p>
<p>函数 <code>sub_D304</code> 处理服务请求，根据输入参数更新现有服务或创建新服务。</p>
<h4 id="sub-B458函数"><a href="#sub-B458函数" class="headerlink" title="sub_B458函数"></a>sub_B458函数</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">sub_B458</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> *v0; <span class="comment">// r4</span></span><br><span class="line">  _DWORD *v1; <span class="comment">// r6</span></span><br><span class="line">  <span class="type">size_t</span> v2; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// r2</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// t1</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// r3</span></span><br><span class="line">  <span class="type">regoff_t</span> *p_rm_eo; <span class="comment">// r2</span></span><br><span class="line">  <span class="type">regoff_t</span> v7; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">regoff_t</span> v8; <span class="comment">// r12</span></span><br><span class="line">  _DWORD *v9; <span class="comment">// r7</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// r5</span></span><br><span class="line">  <span class="type">char</span> *i; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// r3</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// r2</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v14; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// r7</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// r5</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// r0</span></span><br><span class="line">  _DWORD *v18; <span class="comment">// r3</span></span><br><span class="line">  FILE *stream; <span class="comment">// [sp+8h] [bp-88h]</span></span><br><span class="line">  <span class="type">regmatch_t</span> v20[<span class="number">5</span>]; <span class="comment">// [sp+10h] [bp-80h] BYREF</span></span><br><span class="line">  <span class="type">regex_t</span> preg; <span class="comment">// [sp+38h] [bp-58h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v22[<span class="number">14</span>]; <span class="comment">// [sp+58h] [bp-38h] BYREF</span></span><br><span class="line"></span><br><span class="line">  stream = <span class="built_in">fopen</span>(<span class="string">&quot;/etc/inittab&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">regcomp</span>(&amp;preg, <span class="string">&quot;([a-zA-Z0-9]*):([a-zA-Z0-9]*):([a-zA-Z0-9]*):(.*)&quot;</span>, <span class="number">1</span>);<span class="comment">// 编辑一个正则表达式</span></span><br><span class="line">    v0 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x80</span>u);</span><br><span class="line">    v1 = <span class="built_in">malloc</span>(<span class="number">0x64</span>u);</span><br><span class="line">    <span class="built_in">memset</span>(v1, <span class="number">0</span>, <span class="number">0x64</span>u);</span><br><span class="line">LABEL_26:</span><br><span class="line">    <span class="keyword">while</span> ( <span class="built_in">fgets</span>(v0, <span class="number">128</span>, stream) )            <span class="comment">// 读取</span></span><br><span class="line">    &#123;</span><br><span class="line">      v2 = <span class="built_in">strlen</span>(v0);</span><br><span class="line">      v3 = &amp;v0[v2];</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v4 = (<span class="type">unsigned</span> __int8)*--v3;</span><br><span class="line">        <span class="keyword">if</span> ( (*(_WORD *)(_ctype_b + <span class="number">2</span> * v4) &amp; <span class="number">0x20</span>) == <span class="number">0</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        --v2;</span><br><span class="line">      &#125;</span><br><span class="line">      v0[v2] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( *v0 != <span class="string">&#x27;#&#x27;</span> &amp;&amp; !<span class="built_in">regexec</span>(&amp;preg, v0, <span class="number">5u</span>, v20, <span class="number">0</span>) )<span class="comment">// 忽略行首为#</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)debug_level &gt; <span class="number">3</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Parsing inittab - %s&quot;</span>, v0);</span><br><span class="line">          <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: %s(%d): Parsing inittab - %s&quot;</span>, <span class="string">&quot;procd_inittab&quot;</span>, <span class="number">274</span>, v0);</span><br><span class="line">        &#125;</span><br><span class="line">        v5 = <span class="number">0</span>;</span><br><span class="line">        p_rm_eo = &amp;v20[<span class="number">0</span>].rm_eo;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">          v7 = *p_rm_eo;</span><br><span class="line">          v8 = p_rm_eo[<span class="number">1</span>];</span><br><span class="line">          p_rm_eo += <span class="number">2</span>;</span><br><span class="line">          v0[v7] = <span class="number">0</span>;</span><br><span class="line">          v22[v5++] = (<span class="type">int</span>)&amp;v0[v8];             <span class="comment">// 提取字段</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ( v5 != <span class="number">4</span> );</span><br><span class="line">        v9 = v1;</span><br><span class="line">        v10 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> ( i = <span class="built_in">strtok</span>((<span class="type">char</span> *)v22[<span class="number">3</span>], <span class="string">&quot; &quot;</span>); ; i = <span class="built_in">strtok</span>(<span class="number">0</span>, <span class="string">&quot; &quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          v12 = (<span class="type">int</span>)i;</span><br><span class="line">          ++v9;</span><br><span class="line">          <span class="keyword">if</span> ( i )</span><br><span class="line">            v12 = <span class="number">1</span>;</span><br><span class="line">          <span class="keyword">if</span> ( v10 &gt; <span class="number">6</span> )</span><br><span class="line">            v12 = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">if</span> ( !v12 )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          v9[<span class="number">2</span>] = i;</span><br><span class="line">          ++v10;</span><br><span class="line">        &#125;</span><br><span class="line">        v13 = v22[<span class="number">0</span>];</span><br><span class="line">        v14 = (<span class="type">const</span> <span class="type">char</span> *)v22[<span class="number">2</span>];</span><br><span class="line">        v15 = <span class="number">0</span>;</span><br><span class="line">        v1[v10 + <span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">        v16 = <span class="number">0</span>;</span><br><span class="line">        v1[<span class="number">2</span>] = v13;</span><br><span class="line">        v1[<span class="number">11</span>] = v0;</span><br><span class="line">        <span class="keyword">while</span> ( v15 != <span class="number">5</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v17 = <span class="built_in">strcmp</span>((&amp;off_1AA58)[v16], v14); <span class="comment">// 匹配字段</span></span><br><span class="line">          v16 += <span class="number">3</span>;</span><br><span class="line">          <span class="keyword">if</span> ( !v17 )</span><br><span class="line">          &#123;</span><br><span class="line">            *v1 = &amp;off_1AA50;</span><br><span class="line">            v18 = off_1AA54;</span><br><span class="line">            off_1AA54 = v1;</span><br><span class="line">            v1[<span class="number">1</span>] = v18;</span><br><span class="line">            v1[<span class="number">12</span>] = &amp;(&amp;off_1AA58)[<span class="number">3</span> * v15];</span><br><span class="line">            *v18 = v1;</span><br><span class="line">            v0 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x80</span>u);</span><br><span class="line">            v1 = <span class="built_in">malloc</span>(<span class="number">0x64</span>u);</span><br><span class="line">            <span class="built_in">memset</span>(v1, <span class="number">0</span>, <span class="number">0x64</span>u);</span><br><span class="line">            <span class="keyword">goto</span> LABEL_26;</span><br><span class="line">          &#125;</span><br><span class="line">          ++v15;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Unknown init handler %s\n&quot;</span>, v14);</span><br><span class="line">        <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: Unknown init handler %s\n&quot;</span>, v14);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fclose</span>(stream);</span><br><span class="line">    <span class="built_in">free</span>(v0);</span><br><span class="line">    <span class="built_in">free</span>(v1);</span><br><span class="line">    <span class="built_in">regfree</span>(&amp;preg);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;Failed to open %s\n&quot;</span>, <span class="string">&quot;/etc/inittab&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>((FILE *)stderr, <span class="string">&quot;procd: Failed to open %s\n&quot;</span>, <span class="string">&quot;/etc/inittab&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>读取&#x2F;etc&#x2F;inittab文件，匹配格式为 <code>identifier:runlevel:action:process</code> 的行，以处理服务初始化数据</p>
<h5 id="etc-inittab"><a href="#etc-inittab" class="headerlink" title="&#x2F;etc&#x2F;inittab"></a>&#x2F;etc&#x2F;inittab</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (c) 2013 The Linux Foundation. All rights reserved.</span></span><br><span class="line">::sysinit:/etc/init.d/rcS S boot</span><br><span class="line">::shutdown:/etc/init.d/rcS K shutdown</span><br><span class="line">ttyHSL1::askfirst:/bin/login</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*v1 = &amp;off_1AA50;</span><br><span class="line">v18 = off_1AA54;</span><br><span class="line">off_1AA54 = v1;</span><br><span class="line">v1[<span class="number">1</span>] = v18;</span><br><span class="line">v1[<span class="number">12</span>] = &amp;(&amp;off_1AA58)[<span class="number">3</span> * v15];</span><br><span class="line">*v18 = v1;</span><br><span class="line">v0 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x80</span>u);</span><br><span class="line">v1 = <span class="built_in">malloc</span>(<span class="number">0x64</span>u);</span><br><span class="line"><span class="built_in">memset</span>(v1, <span class="number">0</span>, <span class="number">0x64</span>u);</span><br><span class="line"><span class="keyword">goto</span> LABEL_26;</span><br></pre></td></tr></table></figure>

<p>可以看到这部分1AA50已然被修改了</p>
<p>之后执行</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sub_B3F4</span>(<span class="string">&quot;respawn&quot;</span>);</span><br><span class="line"><span class="built_in">sub_B3F4</span>(<span class="string">&quot;askconsole&quot;</span>);</span><br><span class="line"><span class="built_in">sub_B3F4</span>(<span class="string">&quot;askfirst&quot;</span>);</span><br><span class="line"><span class="built_in">sub_B3F4</span>(<span class="string">&quot;sysinit&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>想来算是只会执行最后一个函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> <span class="type">char</span> *__fastcall <span class="title">sub_B3F4</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v1; <span class="comment">// r6</span></span><br><span class="line">  <span class="type">void</span> **i; <span class="comment">// r4</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> **v3; <span class="comment">// r5</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v4; <span class="comment">// r3</span></span><br><span class="line"></span><br><span class="line">  v1 = s2;</span><br><span class="line">  <span class="keyword">for</span> ( i = (<span class="type">void</span> **)off_1AA50; i != &amp;off_1AA50; i = (<span class="type">void</span> **)*i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = (<span class="type">const</span> <span class="type">char</span> **)i[<span class="number">12</span>];</span><br><span class="line">    s2 = (<span class="type">const</span> <span class="type">char</span> *)<span class="built_in">strcmp</span>(*v3, v1);</span><br><span class="line">    <span class="keyword">if</span> ( !s2 )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = v3[<span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( !v3[<span class="number">2</span>] )</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">const</span> <span class="type">char</span> *)((<span class="built_in">int</span> (__fastcall *)(<span class="type">void</span> **))v4)(i);</span><br><span class="line">      s2 = (<span class="type">const</span> <span class="type">char</span> *)((<span class="built_in">int</span> (__fastcall *)(<span class="type">void</span> **))v4)(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> s2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行i[12]即sub_B398（sysinit对应的函数）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">sub_B398</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3, <span class="type">int</span> a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// r1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)(a1 + <span class="number">16</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = *(_DWORD *)(a1 + <span class="number">20</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v4 )</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">sub_BB80</span>(*(_DWORD *)(a1 + <span class="number">16</span>), v4, sub_B394, a4);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">syslog</span>(<span class="number">0</span>, <span class="string">&quot;valid format is rcS &lt;S|K&gt; &lt;param&gt;\n&quot;</span>, a3);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">fputs</span>((<span class="type">const</span> <span class="type">char</span> *)&amp;word_1162A, (FILE *)stderr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">sub_BB80</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">runqueue_init</span>((<span class="type">int</span>)&amp;unk_1ACD0);</span><br><span class="line">  dword_1AD04 = <span class="number">1</span>;</span><br><span class="line">  dword_1AD0C = a3;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_B730</span>((<span class="type">int</span>)&amp;unk_1ACD0, <span class="string">&quot;/etc/rc.d&quot;</span>, a1, (<span class="type">int</span>)<span class="string">&quot;*&quot;</span>, a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大致的作用差不多是添加&#x2F;etc&#x2F;rc.d&#x2F;*下的脚本作为task并执行</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">~/fr/t/_TL-WAR2/squashfs-root/etc ------------------------------------------------------------------------------------------------------------------</span><br><span class="line">&gt; ls -all ./rc.d    </span><br><span class="line">总用量 <span class="number">8</span></span><br><span class="line">drwxr-xr-x  <span class="number">2</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o <span class="number">4096</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> .</span><br><span class="line">drwxr-xr-x <span class="number">39</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o <span class="number">4096</span> <span class="number">12</span>月 <span class="number">25</span> <span class="number">15</span>:<span class="number">44</span> ..</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">19</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> K20miniupnpd -&gt; ../init.d/miniupnpd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">15</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> K26pppox -&gt; ../init.d/pppox</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">18</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> K50dropbear -&gt; ../init.d/dropbear</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">13</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> K80uac -&gt; ../init.d/uac</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">20</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> K81apdb_check -&gt; ../init.d/apdb_check</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">18</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> K90wireless -&gt; ../init.d/wireless</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">14</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> K98boot -&gt; ../init.d/boot</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">22</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> K99luci_monitor -&gt; ../init.d/luci_monitor</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> K99sys_ha -&gt; ../init.d/sys_ha</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> K99umount -&gt; ../init.d/umount</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">20</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S00sysfixtime -&gt; ../init.d/sysfixtime</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">19</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S01led_early -&gt; ../init.d/led_early</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">14</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S10boot -&gt; ../init.d/boot</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S10system -&gt; ../init.d/system</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">15</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S14tddpd -&gt; ../init.d/tddpd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S15loggerd -&gt; ../init.d/loggerd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">19</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S15rsa_check -&gt; ../init.d/rsa_check</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S20network -&gt; ../init.d/network</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S21switch -&gt; ../init.d/<span class="keyword">switch</span></span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S25sysctl -&gt; ../init.d/sysctl</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">22</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S26time_setting -&gt; ../init.d/time_setting</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S31tmngtd -&gt; ../init.d/tmngtd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">15</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S40fstab -&gt; ../init.d/fstab</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">18</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S40watchdog -&gt; ../init.d/watchdog</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S42ipgroup -&gt; ../init.d/ipgroup</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S42ippool -&gt; ../init.d/ippool</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">18</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S45firewall -&gt; ../init.d/firewall</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">13</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S46nat -&gt; ../init.d/nat</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">20</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S47access_ctl -&gt; ../init.d/access_ctl</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">24</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S47administration -&gt; ../init.d/administration</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">21</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S47dos_defense -&gt; ../init.d/dos_defense</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">23</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S47flood_defense -&gt; ../init.d/flood_defense</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">13</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S47imb -&gt; ../init.d/imb</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">20</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S47mac_filter -&gt; ../init.d/mac_filter</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">14</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S50cron -&gt; ../init.d/cron</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">18</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S50dropbear -&gt; ../init.d/dropbear</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">15</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S50pppox -&gt; ../init.d/pppox</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">19</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S50pure-ftpd -&gt; ../init.d/pure-ftpd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">20</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S50queueventd -&gt; ../init.d/queueventd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S50telnet -&gt; ../init.d/telnet</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">18</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S50wireless -&gt; ../init.d/wireless</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">20</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S52qos-tplink -&gt; ../init.d/qos-tplink</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">18</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S60collectd -&gt; ../init.d/collectd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S60dnsmasq -&gt; ../init.d/dnsmasq</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">15</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S60pptpd -&gt; ../init.d/pptpd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">20</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S60url_filter -&gt; ../init.d/url_filter</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S60xl2tpd -&gt; ../init.d/xl2tpd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S62vpn_wan -&gt; ../init.d/vpn_wan</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S65wifidog -&gt; ../init.d/wifidog</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S69ipstat -&gt; ../init.d/ipstat</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S69online -&gt; ../init.d/online</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">22</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S70freeStrategy -&gt; ../init.d/freeStrategy</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">20</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S70init_iface -&gt; ../init.d/init_iface</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">21</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S70qca-nss-drv -&gt; ../init.d/qca-nss-drv</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">21</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S70qca-nss-ecm -&gt; ../init.d/qca-nss-ecm</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">21</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S72shortcut-fe -&gt; ../init.d/shortcut-fe</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">24</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S76session_limits -&gt; ../init.d/session_limits</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S80websort -&gt; ../init.d/websort</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">22</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S83web_security -&gt; ../init.d/web_security</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">19</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S85webfilter -&gt; ../init.d/webfilter</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">21</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S89remote_mngt -&gt; ../init.d/remote_mngt</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">18</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S90dnsproxy -&gt; ../init.d/dnsproxy</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S93appdist -&gt; ../init.d/appdist</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">19</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S93bwlist_qq -&gt; ../init.d/bwlist_qq</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">14</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S93done -&gt; ../init.d/done</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">14</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S93l2tp -&gt; ../init.d/l2tp</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">15</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S93mwan3 -&gt; ../init.d/mwan3</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">25</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S94default_balance -&gt; ../init.d/default_balance</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">19</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S94isp_route -&gt; ../init.d/isp_route</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">22</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S94load_balance -&gt; ../init.d/load_balance</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">19</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S94miniupnpd -&gt; ../init.d/miniupnpd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">22</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S94policy_route -&gt; ../init.d/policy_route</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">22</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S94static_route -&gt; ../init.d/static_route</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S94sysntpd -&gt; ../init.d/sysntpd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">15</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S95ipsec -&gt; ../init.d/ipsec</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">19</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S96cloud_sdk -&gt; ../init.d/cloud_sdk</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">22</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S97cloud_client -&gt; ../init.d/cloud_client</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S97cmxddns -&gt; ../init.d/cmxddns</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">22</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S97dev_discover -&gt; ../init.d/dev_discover</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">21</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S97dyn3322ddns -&gt; ../init.d/dyn3322ddns</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">22</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S97luci_monitor -&gt; ../init.d/luci_monitor</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S97phddns -&gt; ../init.d/phddns</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">23</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S97storage_share -&gt; ../init.d/storage_share</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S97sys_ha -&gt; ../init.d/sys_ha</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">21</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S97sys_monitor -&gt; ../init.d/sys_monitor</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">23</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S97system_params -&gt; ../init.d/system_params</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S97tpddnsd -&gt; ../init.d/tpddnsd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">16</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S97uhttpd -&gt; ../init.d/uhttpd</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">20</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S98apdb_check -&gt; ../init.d/apdb_check</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">13</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S98led -&gt; ../init.d/led</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">13</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S98uac -&gt; ../init.d/uac</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">24</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S98zero_boot_done -&gt; ../init.d/zero_boot_done</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">27</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S99commit_sysupgrade -&gt; ../init.d/commit_sysupgrade</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S99devmngr -&gt; ../init.d/devmngr</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">18</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S99powerctl -&gt; ../init.d/powerctl</span><br><span class="line">lrwxrwxrwx  <span class="number">1</span> s1nec<span class="number">-1</span>o s1nec<span class="number">-1</span>o   <span class="number">17</span> <span class="number">6</span>月  <span class="number">26</span>  <span class="number">2019</span> S99thermal -&gt; ../init.d/thermal</span><br></pre></td></tr></table></figure>

<p>即执行&#x2F;etc&#x2F;init.d&#x2F;下的所有服务</p>
<p><strong>至此启动流程分析完毕</strong></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://s1nec-1o.github.io">s1nec-1o</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://s1nec-1o.github.io/2025/01/04/%E8%B7%AF%E7%94%B1%E5%99%A8%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/">http://s1nec-1o.github.io/2025/01/04/%E8%B7%AF%E7%94%B1%E5%99%A8%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://s1nec-1o.github.io" target="_blank">S1nec-1o's B1og</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/openwrt/">openwrt</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281614288.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/01/23/%E5%88%9D%E6%8E%A2XSS/" title="初探XSS"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">初探XSS</div></div></a></div><div class="next-post pull-right"><a href="/2024/11/23/%E5%88%9D%E6%8E%A2Qiling-framework/" title="初探Qiling framework"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">初探Qiling framework</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281614288.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">s1nec-1o</div><div class="author-info__description">万事胜意</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">23</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="http://github.com/s1nec-1o"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">正在学习iot pwn 欢迎广大师傅与我交流</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">openwrt路由器启动流程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.2.</span> <span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sbin-init"><span class="toc-number">1.4.</span> <span class="toc-text">&#x2F;sbin&#x2F;init</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sub-9110"><span class="toc-number">1.4.1.</span> <span class="toc-text">sub_9110</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sub-98F0"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">sub_98F0</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub-903C"><span class="toc-number">1.4.2.</span> <span class="toc-text">sub_903C</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub-9C04"><span class="toc-number">1.4.3.</span> <span class="toc-text">sub_9C04</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub-94D0"><span class="toc-number">1.4.4.</span> <span class="toc-text">sub_94D0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sbin-procd"><span class="toc-number">1.4.5.</span> <span class="toc-text">&#x2F;sbin&#x2F;procd</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sub-10E20"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">sub_10E20</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#etc-preinit"><span class="toc-number">1.4.6.</span> <span class="toc-text">&#x2F;etc&#x2F;preinit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub-9344"><span class="toc-number">1.4.7.</span> <span class="toc-text">sub_9344</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub-9350"><span class="toc-number">1.4.8.</span> <span class="toc-text">sub_9350</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sbin-procd-1"><span class="toc-number">1.5.</span> <span class="toc-text">&#x2F;sbin&#x2F;procd</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sub-A798"><span class="toc-number">1.5.1.</span> <span class="toc-text">sub_A798</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub-AE4C"><span class="toc-number">1.5.2.</span> <span class="toc-text">sub_AE4C</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub-AC7C"><span class="toc-number">1.5.3.</span> <span class="toc-text">sub_AC7C</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#case1"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">case1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sub-FAF8"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">sub_FAF8</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sub-FA40"><span class="toc-number">1.5.4.</span> <span class="toc-text">sub_FA40</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#case2"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">case2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sub-8D60"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">sub_8D60</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sub-D4CC"><span class="toc-number">1.5.4.3.</span> <span class="toc-text">sub_D4CC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sub-B458%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.4.4.</span> <span class="toc-text">sub_B458函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#etc-inittab"><span class="toc-number">1.5.4.4.1.</span> <span class="toc-text">&#x2F;etc&#x2F;inittab</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/13/protobuf%E5%88%9D%E6%8E%A2/" title="protobuf初探">protobuf初探</a><time datetime="2025-05-13T12:35:17.000Z" title="发表于 2025-05-13 20:35:17">2025-05-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/10/windows-heap%E5%88%9D%E6%8E%A2-2/" title="windows heap初探(2)">windows heap初探(2)</a><time datetime="2025-05-10T07:18:42.000Z" title="发表于 2025-05-10 15:18:42">2025-05-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/08/windows-pwn%E5%88%9D%E6%8E%A2-1/" title="windows pwn初探(1)">windows pwn初探(1)</a><time datetime="2025-05-08T06:27:53.000Z" title="发表于 2025-05-08 14:27:53">2025-05-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/04/Qemu%E9%80%83%E9%80%B8%E5%88%9D%E8%AF%86/" title="Qemu逃逸初识">Qemu逃逸初识</a><time datetime="2025-05-04T06:09:27.000Z" title="发表于 2025-05-04 14:09:27">2025-05-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/14/Android%E9%80%86%E5%90%91%E4%B9%8BWiki%E7%AF%87/" title="Android逆向之Wiki篇">Android逆向之Wiki篇</a><time datetime="2025-04-14T06:44:43.000Z" title="发表于 2025-04-14 14:44:43">2025-04-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/BAMBOOiii/photo@main/img/202404281616326.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By s1nec-1o</div><div class="footer_custom_text">介是s1nec-1o的博客</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><div><canvas id="snow" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:99999;pointer-events:none"></canvas></div><script>const notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));</script><script async type="text/javascript" src="https://cdn.jsdelivr.net/gh/Candinya/Kratos-Rebirth@latest/source/js/snow.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>